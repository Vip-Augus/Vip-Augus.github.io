<!DOCTYPE html>

<html class lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">








<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Spring,">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2">






<meta name="description" content="Spring æ˜¯è¿™æ ·åŠ è½½ xml é…ç½®çš„">
<meta name="keywords" content="Spring">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring æºç å­¦ä¹ (ä¸€)-å®¹å™¨çš„åŸºç¡€ç»“æ„">
<meta property="og:url" content="http://yoursite.com/2019/06/08/spring/2019-06-08-spring-analysis-note-1/index.html">
<meta property="og:site_name" content="JingQ">
<meta property="og:description" content="Spring æ˜¯è¿™æ ·åŠ è½½ xml é…ç½®çš„">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://img.sevenyuan.cn/Manhattanhenge_ZH-CN4659585143_1920x1080.jpg">
<meta property="og:image" content="http://img.sevenyuan.cn/classpath_xml_application_context_herarchy.png">
<meta property="og:image" content="http://img.sevenyuan.cn/standard_servlet_environment.png">
<meta property="og:image" content="http://img.sevenyuan.cn/property_source_herarchy.png">
<meta property="og:image" content="http://img.sevenyuan.cn/property_store.png">
<meta property="og:image" content="http://img.sevenyuan.cn/default_listable_bean_factory_diagram.png">
<meta property="og:image" content="http://img.sevenyuan.cn/entity_resolver_diagram.png">
<meta property="og:image" content="http://img.sevenyuan.cn/xml_bean_definition_reader_diagram.png">
<meta property="og:image" content="http://img.sevenyuan.cn/generic_bean_definition_diagram.png">
<meta property="og:updated_time" content="2019-07-21T03:25:15.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Spring æºç å­¦ä¹ (ä¸€)-å®¹å™¨çš„åŸºç¡€ç»“æ„">
<meta name="twitter:description" content="Spring æ˜¯è¿™æ ·åŠ è½½ xml é…ç½®çš„">
<meta name="twitter:image" content="http://img.sevenyuan.cn/Manhattanhenge_ZH-CN4659585143_1920x1080.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"always","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'JingQ'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/06/08/spring/2019-06-08-spring-analysis-note-1/">





  <title>Spring æºç å­¦ä¹ (ä¸€)-å®¹å™¨çš„åŸºç¡€ç»“æ„ | JingQ</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">JingQ</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-javatech">
          <a href="http://www.justdojava.com/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br>
            
            Java Geek Tech
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

<script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/08/spring/2019-06-08-spring-analysis-note-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JingQ">
      <meta itemprop="description" content>
      <meta itemprop="image" content="http://img.sevenyuan.cn/panda.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JingQ">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Spring æºç å­¦ä¹ (ä¸€)-å®¹å™¨çš„åŸºç¡€ç»“æ„</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-06-08T19:12:00+08:00">
                2019-06-08
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i> æ¸¸è§ˆ
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>æ¬¡
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><img src="http://img.sevenyuan.cn/Manhattanhenge_ZH-CN4659585143_1920x1080.jpg" alt></p>
<center><code>Spring</code> æ˜¯è¿™æ ·åŠ è½½ <code>xml</code> é…ç½®çš„</center>

<a id="more"></a>
<hr>
<p>[TOC]</p>
<hr>
<p>æœ¬ç¯‡ç¬”è®°ä¸»è¦è®°å½•äº†ä»¥ä¸‹å†…å®¹ï¼š</p>
<p>ä½¿ç”¨ <code>ClassPathXmlApplicationContext</code>ï¼Œé€šè¿‡åœ¨ <code>xml</code> æ³¨å†Œä¸€ä¸ª <code>bean</code>ï¼Œè·Ÿè¸ªä»£ç ï¼Œäº†è§£å®ƒä»é…ç½®æ–‡ä»¶çš„ <code>&lt;bean&gt;</code> æ ‡ç­¾ï¼ŒåŠ è½½åˆ° <code>BeanFactory</code> æ³¨å†Œè¡¨ <code>beanDefinitionMap</code> çš„è¯¦ç»†è¿‡ç¨‹ã€‚</p>
<p><strong>å±•ç¤ºçš„ä»£ç æ‘˜å–äº†ä¸€äº›æ ¸å¿ƒæ–¹æ³•ï¼Œå»æ‰ä¸€äº›é»˜è®¤è®¾ç½®å’Œæ—¥å¿—è¾“å‡ºï¼Œè¿˜æœ‰å¤§å¤šæ•°é”™è¯¯å¼‚å¸¸ä¹Ÿå»æ‰äº†ï¼Œå°ä¼™ä¼´æƒ³çœ‹è¯¦ç»†ä»£ç ï¼Œæ³¨é‡Šå’Œ demoï¼Œå¯ä»¥ä¸‹è½½æˆ‘ä¸Šä¼ çš„ç¬”è®°é¡¹ç›®ğŸ“’</strong></p>
<p><a href="https://gitee.com/vip-augus/spring-analysis-note.git" target="_blank" rel="noopener">ç äº‘ Gitee åœ°å€</a></p>
<p><a href="https://github.com/Vip-Augus/spring-analysis-note" target="_blank" rel="noopener">Github åœ°å€</a></p>
<p>é€šè¿‡é˜…è¯»æºç çš„è¿‡ç¨‹ï¼Œäº†è§£è®¾è®¡è€…çš„è®¾è®¡æ€è·¯å’Œä»ä¸­å­¦ä¹ ï¼Œå¯¹ <code>spring</code> æœ‰ä¸ªåŸºç¡€çš„äº†è§£ã€‚</p>
<hr>
<h1 id="åŸºç¡€ç»“æ„"><a href="#åŸºç¡€ç»“æ„" class="headerlink" title="åŸºç¡€ç»“æ„"></a>åŸºç¡€ç»“æ„</h1><p>ä¸€å¼€å§‹å…ˆä»‹ç»å¦‚ä½•åœ¨ä»£ç ä¸­æ³¨å†Œå’Œä½¿ç”¨ <code>bean</code>ï¼š</p>
<blockquote>
<p>config.xml</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"book"</span> <span class="attr">class</span>=<span class="string">"domain.SimpleBook"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å®šä¹‰ä¸€ä¸ªç®€å•ç±»ï¼š</p>
<blockquote>
<p>SimpleBook.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleBook</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String name = <span class="string">"Default Name"</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ <code>ClassPathXmlApplicationContext</code> ä» <code>xml</code> é…ç½®æ–‡ä»¶ä¸­è·å– <code>bean</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">	ClassPathXmlApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"config.xml"</span>);</span><br><span class="line">	SimpleBook book = context.getBean(SimpleBook<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">	System.out.println(book.getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ­£å¸¸è¿è¡Œä»£ç åï¼Œæ§åˆ¶å°ä¼šè¾“å‡º:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Default Name</span><br></pre></td></tr></table></figure>
<p>é€šå¸¸æ¥è¯´ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡ï¼Œéœ€è¦é€šè¿‡ <code>new</code> åˆå§‹åŒ–ï¼Œåˆ†é…å†…å­˜ç©ºé—´ç­‰æ“ä½œè¿›è¡Œå®ä¾‹åŒ–ï¼Œä½†æœ‰äº† <code>Spring</code> å®¹å™¨åï¼Œæˆ‘ä»¬å¯ä»¥å°† <code>SimpleBook</code> äº¤ç»™äº† <code>Spring</code> è¿›è¡Œç®¡ç†ï¼Œä¸éœ€è¦åœ¨ä»£ç ä¸­è¿›è¡Œ <code>new SimpleBook</code> ç­‰æ“ä½œï¼Œé€šè¿‡è‡ªåŠ¨æ³¨å…¥ï¼ˆä¾‹å¦‚ <code>@Autowire</code> æ³¨è§£ï¼‰ï¼Œæˆ–è€…åƒä¾‹å­ä¸­çš„ï¼Œè·å–ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œç„¶åä½¿ç”¨ <code>getBean()</code>æ–¹æ³•ï¼Œå¯ä»¥æ–¹ä¾¿çš„è·å–å¯¹è±¡å®ä¾‹~ã€‚</p>
<hr>
<h2 id="ClassPathXmlApplicationContext"><a href="#ClassPathXmlApplicationContext" class="headerlink" title="ClassPathXmlApplicationContext"></a>ClassPathXmlApplicationContext</h2><p><code>ClassPathXmlApplicationContext</code> çš„ç»§æ‰¿ä½“ç³»ç»“æ„å›¾ï¼š</p>
<p><img src="http://img.sevenyuan.cn/classpath_xml_application_context_herarchy.png" alt="ClassPathXmlApplicationContext"></p>
<p>è¿™ç§ç»“æ„å›¾æ˜¯é€šè¿‡ <code>IDEA</code> ç¼–è¾‘å™¨çš„ <code>Diagrams</code> åŠŸèƒ½å±•ç¤ºçš„ï¼Œå¯¹å½“å‰ç±»å³é”®é€‰æ‹©ï¼Œå¯ä»¥çœ‹åˆ°ç»§æ‰¿ä½“ç³»ï¼Œç»§æ‰¿äº†å“ªäº›ç±»å’Œå¼•ç”¨äº†å“ªäº›æ¥å£ï¼Œæ–¹ä¾¿æˆ‘ä»¬å»äº†è§£~ </p>
<p><code>ClassPathXmlApplicationContext</code> ç»§æ‰¿è‡ª <code>AbstractApplicationContext</code>ï¼Œè€Œ <code>AbstractRefreshableApplicationContext</code> æ˜¯ <code>AbstractApplicationContext</code> çš„æŠ½è±¡å­ç±»ï¼Œä½¿ç”¨çš„ç±»æ³¨å†Œå·¥å‚æ˜¯ <code>DefaultListableBeanFactory</code>ï¼Œè¿™ä¸ªæ³¨å†Œå·¥å‚ä¹Ÿå¾ˆé‡è¦ï¼Œåé¢ä¼šæœ‰å®ƒçš„ä»‹ç»ã€‚</p>
<p><strong>ç®€å•æ¥è¯´ï¼Œ<code>DefaultListableBeanFactory</code> æ˜¯ <code>Spring</code> æ³¨å†ŒåŠåŠ è½½ <code>bean</code> çš„é»˜è®¤å®ç°ï¼Œå®ƒä¼šå°†æ³¨å†Œçš„ <code>bean</code>æ”¾å…¥ <code>beanDefinitionMap</code> è¿›è¡Œ <code>key-value</code> å½¢å¼å­˜å‚¨ã€‚</strong></p>
<p>åœ¨å›¾ç‰‡çš„å³ä¸Šè§’èƒ½çœ‹åˆ°ï¼Œ<code>ResourceLoader</code> æ˜¯å®ƒçš„é¡¶å±‚æ¥å£ï¼Œè¡¨ç¤ºè¿™ä¸ªç±»å®ç°äº†èµ„æºåŠ è½½åŠŸèƒ½ã€‚</p>
<p>æ„é€ å™¨çš„ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ClassPathXmlApplicationContext</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">		String[] configLocations, <span class="keyword">boolean</span> refresh, @Nullable ApplicationContext parent)</span></span></span><br><span class="line"><span class="function">		<span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">	<span class="keyword">super</span>(parent);</span><br><span class="line">	<span class="comment">// æ³¨é‡Š 1.1 è·å–èµ„æºæ–‡ä»¶</span></span><br><span class="line">	setConfigLocations(configLocations);</span><br><span class="line">	<span class="keyword">if</span> (refresh) &#123;</span><br><span class="line">		refresh();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="æ„é€ å™¨"><a href="#æ„é€ å™¨" class="headerlink" title="æ„é€ å™¨"></a>æ„é€ å™¨</h3><p>ä»è¿™è¡Œä»£ç çœ‹å‡ºï¼Œå­ç±»æ„é€ å™¨è°ƒç”¨äº†çˆ¶ç±»çš„æ„é€ å™¨ï¼š</p>
<p><code>super(parent)</code></p>
<p>ä¸€ç›´è·Ÿè¸ªä»£ç ï¼Œå‘ç°ä»å­ç±»å¼€å§‹ï¼Œæ²¿ç€çˆ¶ç±»ä¸€ç›´å¾€ä¸Šè°ƒç”¨ï¼Œç›´åˆ° <code>AbstractApplicationContext</code> :</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">AbstractApplicationContext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.resourcePatternResolver = getResourcePatternResolver();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">AbstractApplicationContext</span><span class="params">(@Nullable ApplicationContext parent)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>();</span><br><span class="line">	setParent(parent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> ResourcePatternResolver <span class="title">getResourcePatternResolver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> PathMatchingResourcePatternResolver(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆå§‹åŒ–å‡½æ•°ä¸»è¦ç”¨æ¥è®¾å®šèµ„æºåŒ¹é…çš„å¤„ç†å™¨ï¼Œ<code>ResourcePatternResolver</code> æ¥å£å®šä¹‰äº†å°†ä½ç½®æ¨¡å¼(ä¾‹å¦‚ï¼Œ antæ ·å¼çš„è·¯å¾„æ¨¡å¼)è§£æä¸ºèµ„æºå¯¹è±¡çš„ç­–ç•¥ï¼Œå…·ä½“å®ç°ç±»æ˜¯ <code>PathMatchingResourcePatternResolver</code> (è·¯å¾„åŒ¹é…èµ„æºæ¨¡å¼è§£æå™¨ï¼Œç”¨æ¥è§£ææˆ‘ä»¬ä¼ å…¥çš„è·¯å¾„ <code>config.xml</code>ï¼‰</p>
<hr>
<h3 id="è®¾ç½®é…ç½®æ–‡ä»¶è·¯å¾„"><a href="#è®¾ç½®é…ç½®æ–‡ä»¶è·¯å¾„" class="headerlink" title="è®¾ç½®é…ç½®æ–‡ä»¶è·¯å¾„"></a>è®¾ç½®é…ç½®æ–‡ä»¶è·¯å¾„</h3><blockquote>
<p>org.springframework.context.support.AbstractRefreshableConfigApplicationContext</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setConfigLocations</span><span class="params">(@Nullable String... locations)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (locations != <span class="keyword">null</span>) &#123;</span><br><span class="line">		Assert.noNullElements(locations, <span class="string">"Config locations must not be null"</span>);</span><br><span class="line">		<span class="comment">// æ³¨é‡Š 1.2 å°†é…ç½®èµ„æºè·¯å¾„æ”¾å…¥ configLocations æ•°ç»„ä¸­</span></span><br><span class="line">		<span class="keyword">this</span>.configLocations = <span class="keyword">new</span> String[locations.length];</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; locations.length; i++) &#123;</span><br><span class="line">			<span class="keyword">this</span>.configLocations[i] = resolvePath(locations[i]).trim();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">this</span>.configLocations = <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>resolvePath</code>ï¼Œç”¨é€”æ˜¯ï¼š<strong>è§£æç»™å®šçš„è·¯å¾„ï¼Œç”¨å¯¹åº”çš„å ä½ç¬¦(placeholder)æ›¿æ¢å ä½ç¬¦</strong></p>
<p>ä¾‹å¦‚ <code>new ClassPathXmlApplicationContext(&quot;classpath:config.xml&quot;);</code>ï¼Œå°±éœ€è¦è§£æ <code>classpath</code>ï¼Œå˜æˆæ­£ç¡®è·¯å¾„ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> String <span class="title">resolvePath</span><span class="params">(String path)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> getEnvironment().resolveRequiredPlaceholders(path);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æœ‰ä¸åŒçš„è¿è¡Œç¯å¢ƒï¼Œ<code>dev</code>ï¼Œ<code>test</code> æˆ–è€… <code>prod</code>ï¼Œè¿™ä¸ªæ—¶å€™åŠ è½½çš„é…ç½®æ–‡ä»¶å’Œå±æ€§åº”è¯¥æœ‰æ‰€ä¸åŒï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä½¿ç”¨åˆ° <code>Environment</code> æ¥è¿›è¡ŒåŒºåˆ†ã€‚</p>
<p><code>Spring</code> ç¯å¢ƒå’Œå±æ€§æ˜¯ç”±å››ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p>
<ul>
<li><code>Environment</code> ï¼š ç¯å¢ƒï¼Œç”± <code>Profile</code> å’Œ <code>PropertyResolver</code> ç»„åˆã€‚</li>
<li><code>Profile</code> : é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥ç†è§£ä¸ºï¼Œå®¹å™¨é‡Œå¤šä¸ªé…ç½®ç»„åˆ«çš„å±æ€§å’Œ <code>bean</code>ï¼Œåªæœ‰æ¿€æ´»çš„ <code>profile</code>ï¼Œå®ƒå¯¹åº”çš„ç»„åˆ«å±æ€§å’Œ <code>bean</code> æ‰ä¼šè¢«åŠ è½½ </li>
<li><code>PropertySource</code> ï¼š å±æ€§æºï¼Œ ä½¿ç”¨ <code>CopyOnWriteArrayList</code> æ•°ç»„è¿›è¡Œå±æ€§å¯¹ <code>key-value</code> å½¢å¼å­˜å‚¨</li>
<li><code>PropertyResolver</code> ï¼šå±æ€§è§£æå™¨ï¼Œè¿™ä¸ªç”¨é€”å°±æ˜¯è§£æå±æ€§</li>
</ul>
<hr>
<h4 id="Environment"><a href="#Environment" class="headerlink" title="Environment"></a>Environment</h4><p>é¦–å…ˆæ¥çœ‹ <code>StandardServletEnvironment</code> çš„ç»§æ‰¿ä½“ç³»:</p>
<p><img src="http://img.sevenyuan.cn/standard_servlet_environment.png" alt="StandardServletEnvironment"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œé¡¶å±‚æ¥å£æ˜¯ <code>PropertyResolver</code>ï¼Œå®ƒæ˜¯ç”¨æ¥è§£æå±æ€§çš„ï¼Œæœ€ç»ˆè§£æè°ƒç”¨æ–¹æ³•çš„æ˜¯</p>
<blockquote>
<p>PropertyPlaceholderHelper.replacePlaceholders</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">replacePlaceholders</span><span class="params">(String value, PlaceholderResolver placeholderResolver)</span> </span>&#123;</span><br><span class="line">	Assert.notNull(value, <span class="string">"'value' must not be null"</span>);</span><br><span class="line">    <span class="comment">// ç”¨è¿”å›çš„å€¼æ›¿æ¢æ ¼å¼ä¸º&#123;@code $&#123;name&#125;&#125;çš„æ‰€æœ‰å ä½ç¬¦</span></span><br><span class="line">	<span class="keyword">return</span> parseStringValue(value, placeholderResolver, <span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="Profile"><a href="#Profile" class="headerlink" title="Profile"></a>Profile</h4><p>é€šè¿‡è¿™ä¸ªå±æ€§ï¼Œå¯ä»¥åŒæ—¶åœ¨é…ç½®æ–‡ä»¶ä¸­éƒ¨ç½²ä¸¤å¥—é…ç½®ï¼Œç”¨æ¥é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒå’Œå¼€å‘ç¯å¢ƒï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿çš„è¿›è¡Œåˆ‡æ¢å¼€å‘ã€éƒ¨ç½²ç¯å¢ƒï¼Œå¸¸ç”¨æ¥æ›´æ¢ä¸åŒçš„æ•°æ®åº“æˆ–è€…é…ç½®æ–‡ä»¶ã€‚</p>
<p><code>demo</code>:ï¼ˆå¼•ç”¨è‡ªå‚è€ƒèµ„æ–™ç¬¬å››æ¡ï¼‰</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æµ‹è¯•ç¯å¢ƒé…ç½®æ–‡ä»¶ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">profile</span>=<span class="string">"test"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:test/*.properties, classpath:common/*.properties"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- ç”Ÿäº§ç¯å¢ƒé…ç½®æ–‡ä»¶ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">profile</span>=<span class="string">"production"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:production/*.properties, classpath:common/*.properties"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- å¼€å‘ç¯å¢ƒé…ç½®æ–‡ä»¶ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">profile</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:dev/*.properties, classpath:common/*.properties"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥è®¾ç½®é€‰æ‹©ä½¿ç”¨å“ªå¥—é…ç½®ï¼š</strong></p>
<p>â‘  åœ¨ <code>web.xml</code> ä¸­è®¾ç½®</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>spring.profiles.active<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>test<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>â‘¡ åœ¨ä»£ç å¯åŠ¨æ—¶è®¾ç½®</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">context.getEnvironment().setActiveProfiles(<span class="string">"test"</span>);</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="Property"><a href="#Property" class="headerlink" title="Property"></a>Property</h4><p><code>Property</code> å®˜æ–¹æ³¨é‡Šæè¿°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A description of a JavaBeans Property that allows us to avoid a dependency on</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> java.beans.PropertyDescriptor&#125;. The &#123;<span class="doctag">@code</span> java.beans&#125; package</span></span><br><span class="line"><span class="comment"> * is not available in a number of environments (e.g. Android, Java ME), so this is</span></span><br><span class="line"><span class="comment"> * desirable for portability of Spring's core conversion facility.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"></span><br><span class="line">å®ƒå…è®¸æˆ‘ä»¬é¿å…å¯¹ &#123;<span class="meta">@code</span> java.bean . propertydescriptor&#125;çš„ä¾èµ–ã€‚</span><br><span class="line"></span><br><span class="line">å› ä¸º &#123;<span class="meta">@code</span> javaã€‚bean&#125; <span class="keyword">package</span> åœ¨è®¸å¤šç¯å¢ƒä¸­éƒ½ä¸å¯ç”¨(ä¾‹å¦‚ Androidã€Java ME)ï¼Œå› æ­¤è¿™å¯¹äº Spring çš„æ ¸å¿ƒè½¬æ¢å·¥å…·çš„å¯ç§»æ¤æ€§æ¥è¯´æ˜¯éå¸¸ç†æƒ³çš„ã€‚</span><br></pre></td></tr></table></figure>
<p>åœ¨ <code>AbstractEnvironment.java</code> ä¸­èƒ½æ‰¾åˆ°ï¼Œåœ¨è®¾ç½®ç¯å¢ƒ <code>env</code> æ—¶ï¼Œ<code>new</code> äº†ä¸€ä¸ª <code>MutablePropertySources</code>ï¼Œç”¨è¿™ä¸ªå¯¹è±¡æ¥ä¿å­˜å±æ€§ ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> MutablePropertySources propertySources = <span class="keyword">new</span> MutablePropertySources()</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ConfigurablePropertyResolver propertyResolver =</span><br><span class="line">			<span class="keyword">new</span> PropertySourcesPropertyResolver(<span class="keyword">this</span>.propertySources);</span><br><span class="line">            </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">AbstractEnvironment</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	customizePropertySources(<span class="keyword">this</span>.propertySources);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="PropertySource-æ¥å£"><a href="#PropertySource-æ¥å£" class="headerlink" title="PropertySource æ¥å£"></a>PropertySource æ¥å£</h4><p>ç»§æ‰¿ä½“ç³»å¦‚å›¾ï¼š</p>
<p><img src="http://img.sevenyuan.cn/property_source_herarchy.png" alt="PropertySource"></p>
<p>ä» <code>PropertySource</code> ç»§æ‰¿ä½“ç³»æ¥çœ‹ï¼Œ<code>customizePropertySources</code> æ–¹æ³•çš„è°ƒç”¨é“¾è·¯æ˜¯ä»å­ç±»ä¸€ç›´å¾€ä¸Šè°ƒç”¨ ï¼š</p>
<p><code>AbstractEnvironment</code> -&gt; <code>StandardServletEnvironment</code> -&gt; <code>StandardEnvironment</code></p>
<p>æœ€ç»ˆåœ¨ <code>StandardEnvironment</code> ä½¿ç”¨ <code>CopyOnWriteArrayList</code> æ•°ç»„è¿›è¡Œå±æ€§å­˜å‚¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">customizePropertySources</span><span class="params">(MutablePropertySources propertySources)</span> </span>&#123;</span><br><span class="line">	propertySources.addLast(<span class="keyword">new</span> MapPropertySource(SYSTEM_PROPERTIES_PROPERTY_SOURCE_NAME, getSystemProperties()));</span><br><span class="line">	propertySources.addLast(<span class="keyword">new</span> SystemEnvironmentPropertySource(SYSTEM_ENVIRONMENT_PROPERTY_SOURCE_NAME, getSystemEnvironment()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¾‹å¦‚ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œ<code>propertySourceList</code> å°†ä¼šå­˜å‚¨ç³»ç»Ÿçš„å‚æ•°ï¼š</p>
<p><img src="http://img.sevenyuan.cn/property_store.png" alt></p>
<p>åˆ°æ—¶è¿™äº›å‚æ•°å°±èƒ½åœ¨å¯åŠ¨çš„åº”ç”¨ä¸­ï¼Œé€šè¿‡ä¸Šä¸‹æ–‡ <code>context</code> è¿›è¡Œè·å–</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((MutablePropertySources)((StandardEnvironment)context.environment).propertySources).propertySourceList</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>åˆšæ‰ä¸€ç³»åˆ—çš„å‰å¥å·¥ä½œï¼Œåªæ˜¯ç”¨æ¥è¯†åˆ«è·¯å¾„èµ„æºå’ŒåŠ è½½ç³»ç»Ÿå‚æ•°</p>
<ul>
<li><strong>è®¾å®šæ„é€ å™¨</strong></li>
<li><strong>è¯†åˆ«è·¯å¾„å˜é‡</strong></li>
<li><strong>è®¾å®šç¯å¢ƒå‚æ•°</strong>ï¼šä¸»è¦æ˜¯ <code>Environment</code> ä½“ç³»ï¼Œè¿˜æœ‰åœ¨ <code>propertySources</code> ä¸­ä¿å­˜äº†è¿è¡Œæ—¶çš„å‚æ•°</li>
</ul>
<hr>
<h2 id="Bean-çš„è§£æå’Œæ³¨å†Œ"><a href="#Bean-çš„è§£æå’Œæ³¨å†Œ" class="headerlink" title="Bean çš„è§£æå’Œæ³¨å†Œ"></a>Bean çš„è§£æå’Œæ³¨å†Œ</h2><p><code>Spring bean</code> çš„è§£æå’Œæ³¨å†Œæœ‰ä¸€ä¸ªé‡è¦çš„æ–¹æ³• <code>refresh()</code></p>
<blockquote>
<p>AbstractApplicationContext.refresh()</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">refresh</span><span class="params">()</span> <span class="keyword">throws</span> BeansException, IllegalStateException </span>&#123;</span><br><span class="line">	<span class="keyword">synchronized</span> (<span class="keyword">this</span>.startupShutdownMonitor) &#123;</span><br><span class="line">		<span class="comment">// Prepare this context for refreshing. ï¼ˆä¸ºæ›´æ–°å‡†å¤‡ä¸Šä¸‹æ–‡ï¼Œè®¾å®šä¸€äº›æ ‡å¿—ï¼‰</span></span><br><span class="line">		prepareRefresh();</span><br><span class="line">		<span class="comment">// Tell the subclass to refresh the internal bean factory. ï¼ˆå‘Šè¯‰å­ç±»å»æ›´æ–°å®ƒä»¬çš„ bean factoryï¼‰</span></span><br><span class="line">		<span class="comment">// ç±»çš„æ³¨å†Œåˆ° bean factory ä¹Ÿæ˜¯åœ¨è¿™ä¸€æ­¥</span></span><br><span class="line">		ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory();</span><br><span class="line">		<span class="comment">// Prepare the bean factory for use in this context.</span></span><br><span class="line">		prepareBeanFactory(beanFactory);</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// Allows post-processing of the bean factory in context subclasses.</span></span><br><span class="line">			postProcessBeanFactory(beanFactory);</span><br><span class="line">			<span class="comment">// Invoke factory processors registered as beans in the context.</span></span><br><span class="line">			invokeBeanFactoryPostProcessors(beanFactory);</span><br><span class="line">			<span class="comment">// Register bean processors that intercept bean creation.</span></span><br><span class="line">			registerBeanPostProcessors(beanFactory);</span><br><span class="line">			<span class="comment">// Initialize message source for this context.</span></span><br><span class="line">			initMessageSource();</span><br><span class="line">			<span class="comment">// Initialize event multicaster for this context.</span></span><br><span class="line">			initApplicationEventMulticaster();</span><br><span class="line">			<span class="comment">// Initialize other special beans in specific context subclasses.</span></span><br><span class="line">			onRefresh();</span><br><span class="line">			<span class="comment">// Check for listener beans and register them.</span></span><br><span class="line">			registerListeners();</span><br><span class="line">			<span class="comment">// Instantiate all remaining (non-lazy-init) singletons.</span></span><br><span class="line">			finishBeanFactoryInitialization(beanFactory);</span><br><span class="line">			<span class="comment">// Last step: publish corresponding event.</span></span><br><span class="line">			finishRefresh();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">catch</span> (BeansException ex) &#123;</span><br><span class="line">			<span class="keyword">if</span> (logger.isWarnEnabled()) &#123;</span><br><span class="line">				logger.warn(<span class="string">"Exception encountered during context initialization - "</span> +</span><br><span class="line">						<span class="string">"cancelling refresh attempt: "</span> + ex);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// Destroy already created singletons to avoid dangling resources.</span></span><br><span class="line">			destroyBeans();</span><br><span class="line">			<span class="comment">// Reset 'active' flag.</span></span><br><span class="line">			cancelRefresh(ex);</span><br><span class="line">			<span class="comment">// Propagate exception to caller.</span></span><br><span class="line">			<span class="keyword">throw</span> ex;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="comment">// Reset common introspection caches in Spring's core, since we</span></span><br><span class="line">			<span class="comment">// might not ever need metadata for singleton beans anymore...</span></span><br><span class="line">			resetCommonCaches();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢ä¼šå›´ç»•è¿™ä¸ªæ–¹æ³•è¿›è¡Œè·Ÿè¸ªå’Œåˆ†æã€‚</p>
<hr>
<h3 id="prepareRefresh-å‡†å¤‡æ›´æ–°"><a href="#prepareRefresh-å‡†å¤‡æ›´æ–°" class="headerlink" title="prepareRefresh å‡†å¤‡æ›´æ–°"></a>prepareRefresh å‡†å¤‡æ›´æ–°</h3><p>è¯¥æ–¹æ³•ä½œç”¨ï¼š<strong>å‡†å¤‡æ­¤ä¸Šä¸‹æ–‡ç”¨äºåˆ·æ–°ã€è®¾ç½®å…¶å¯åŠ¨æ—¥æœŸå’Œ <code>active</code> æ ‡å¿—ï¼Œä»¥åŠæ‰§è¡Œä»»ä½•å±æ€§æºçš„åˆå§‹åŒ–ã€‚</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">prepareRefresh</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">// Switch to active.</span></span><br><span class="line">	<span class="comment">// Initialize any placeholder property sources in the context environment.(ç©ºæ–¹æ³•ï¼Œç­‰å­ç±»å®ç°ï¼‰</span></span><br><span class="line">	initPropertySources();</span><br><span class="line">	<span class="comment">// Validate that all properties marked as required are resolvable:ï¼ˆæ ¡éªŒå‚æ•°ï¼‰</span></span><br><span class="line">	<span class="comment">// see ConfigurablePropertyResolver#setRequiredProperties</span></span><br><span class="line">	getEnvironment().validateRequiredProperties();</span><br><span class="line">	<span class="comment">// Allow for the collection of early ApplicationEvents,</span></span><br><span class="line">	<span class="comment">// to be published once the multicaster is available...</span></span><br><span class="line">	<span class="keyword">this</span>.earlyApplicationEvents = <span class="keyword">new</span> LinkedHashSet&lt;&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="å…·ä½“æ ¡éªŒçš„æ–¹æ³•"><a href="#å…·ä½“æ ¡éªŒçš„æ–¹æ³•" class="headerlink" title="å…·ä½“æ ¡éªŒçš„æ–¹æ³•"></a>å…·ä½“æ ¡éªŒçš„æ–¹æ³•</h4><blockquote>
<p>org.springframework.core.env.AbstractPropertyResolver#validateRequiredProperties</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">validateRequiredProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	MissingRequiredPropertiesException ex = <span class="keyword">new</span> MissingRequiredPropertiesException();</span><br><span class="line">	<span class="keyword">for</span> (String key : <span class="keyword">this</span>.requiredProperties) &#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.getProperty(key) == <span class="keyword">null</span>) &#123;</span><br><span class="line">			ex.addMissingRequiredProperty(key);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (!ex.getMissingRequiredProperties().isEmpty()) &#123;</span><br><span class="line">		<span class="keyword">throw</span> ex;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæ ¡éªŒé€»è¾‘æ˜¯éå† <code>requiredProperties</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªå­—ç¬¦ <code>Set</code>ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯ç©ºï¼Œè¡¨ç¤ºä¸éœ€è¦æ ¡éªŒä»»ä½•å…ƒç´ ï¼Œå¦‚æœåˆ—è¡¨ä¸­æœ‰å€¼ï¼Œç„¶åæ ¹æ® <code>key</code> è·å–å¯¹åº”çš„ç¯å¢ƒå˜é‡ä¸ºç©ºï¼Œå°†ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¯¼è‡´ <code>Spring</code> å®¹å™¨åˆå§‹åŒ–å¤±è´¥ã€‚</p>
<hr>
<h4 id="è‡ªå®šä¹‰ç¯å¢ƒå˜é‡æ ¡éªŒ"><a href="#è‡ªå®šä¹‰ç¯å¢ƒå˜é‡æ ¡éªŒ" class="headerlink" title="è‡ªå®šä¹‰ç¯å¢ƒå˜é‡æ ¡éªŒ"></a>è‡ªå®šä¹‰ç¯å¢ƒå˜é‡æ ¡éªŒ</h4><p>æ—¢ç„¶ç»™å‡ºäº† <code>requireProperties</code> åˆ—è¡¨ï¼Œè¡¨ç¤ºæˆ‘ä»¬èƒ½å¤Ÿå¾€é‡Œé¢è‡ªå®šä¹‰æ·»åŠ ï¼Œéœ€è¦æ ¡éªŒçš„ç¯å¢ƒå˜é‡ï¼š</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ªç±»ï¼Œç»§æ‰¿è‡ª <code>AnnotationConfigServletWebServerApplicationContext</code>ï¼Œé‡è½½ <code>initPropertySources</code></li>
<li>åœ¨åº”ç”¨å¯åŠ¨æ—¶ï¼Œå°†è‡ªå·±æ–°å»ºçš„ç±»è®¾å®šæˆåº”ç”¨ä¸Šä¸‹æ–‡(<code>application.setApplicationContextClass(CustomContext.class);</code>)</li>
</ul>
<p>ä¾‹å¦‚ï¼šï¼ˆå¼•ç”¨è‡ªå‚è€ƒèµ„æ–™ç¬¬äº”æ¡ï¼‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomApplicationContext</span> <span class="keyword">extends</span> <span class="title">AnnotationConfigServletWebServerApplicationContext</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initPropertySources</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.initPropertySources();</span><br><span class="line">        <span class="comment">//æŠŠ"MYSQL_HOST"ä½œä¸ºå¯åŠ¨çš„æ—¶å€™å¿…é¡»éªŒè¯çš„ç¯å¢ƒå˜é‡</span></span><br><span class="line">        getEnvironment().setRequiredProperties(<span class="string">"MYSQL_HOST"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    SpringApplication springApplication = <span class="keyword">new</span> SpringApplication(CustomizepropertyverifyApplication<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    springApplication.setApplicationContextClass(CustomApplicationContext<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    springApplication.run(args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡æ·»åŠ è‡ªå®šä¹‰çš„æ ¡éªŒå€¼ï¼Œåœ¨ <code>Spring</code> åº”ç”¨å¯åŠ¨æ—¶ï¼Œå°±èƒ½æå‰è¿›è¡Œæ ¡éªŒ</p>
<hr>
<h3 id="è·å–-bean-å®¹å™¨"><a href="#è·å–-bean-å®¹å™¨" class="headerlink" title="è·å– bean å®¹å™¨"></a>è·å– <code>bean</code> å®¹å™¨</h3><p>åœ¨è¿™è¡Œä»£ç ä¸­ <code>ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory();</code></p>
<p>å…·ä½“è°ƒç”¨çš„æ˜¯ :</p>
<blockquote>
<p>org.springframework.context.support.AbstractRefreshableApplicationContext#refreshBeanFactory</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">refreshBeanFactory</span><span class="params">()</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">	<span class="comment">// åœ¨æ›´æ–°æ—¶ï¼Œå¦‚æœå‘ç°å·²ç»å­˜åœ¨ï¼Œå°†ä¼šæŠŠä¹‹å‰çš„ bean æ¸…ç†æ‰ï¼Œå¹¶ä¸”å…³é—­è€ bean å®¹å™¨</span></span><br><span class="line">	<span class="keyword">if</span> (hasBeanFactory()) &#123;</span><br><span class="line">		destroyBeans();</span><br><span class="line">		closeBeanFactory();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		DefaultListableBeanFactory beanFactory = createBeanFactory();</span><br><span class="line">		beanFactory.setSerializationId(getId());</span><br><span class="line">		customizeBeanFactory(beanFactory);</span><br><span class="line">		<span class="comment">// æ³¨é‡Š 1.3 å¼€å§‹åŠ è½½ ï¼ˆbean æ³¨å†Œï¼‰</span></span><br><span class="line">		loadBeanDefinitions(beanFactory);</span><br><span class="line">		<span class="keyword">synchronized</span> (<span class="keyword">this</span>.beanFactoryMonitor) &#123;</span><br><span class="line">			<span class="keyword">this</span>.beanFactory = beanFactory;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> ApplicationContextException(<span class="string">"I/O error parsing bean definition source for "</span> + getDisplayName(), ex);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªå…¥å£æ–¹æ³•å¾ˆé‡è¦ï¼Œåœ¨è¿™ä¸€æ­¥æ–°å»ºäº† <code>bean</code> å®¹å™¨å’Œè§£æ <code>bean</code>ï¼Œå¹¶å°† <code>bean</code> æ³¨å†Œåˆ°å®¹å™¨ä¸­ã€‚</p>
<hr>
<h4 id="BeanFactory-ç»§æ‰¿ä½“ç³»"><a href="#BeanFactory-ç»§æ‰¿ä½“ç³»" class="headerlink" title="BeanFactory ç»§æ‰¿ä½“ç³»"></a>BeanFactory ç»§æ‰¿ä½“ç³»</h4><p>æœ¬æ¬¡ä¾‹å­ä»¥åŠå¤šæ•°æƒ…å†µä¸‹ï¼Œä½¿ç”¨çš„ <code>bean</code> å®¹å™¨éƒ½æ˜¯ <code>DefaultListableBeanFactory</code>ï¼Œæ‰€ä»¥æ¥ä»‹ç»ä¸€ä¸‹å®ƒçš„ç»§æ‰¿ä½“ç³»ï¼š</p>
<p><img src="http://img.sevenyuan.cn/default_listable_bean_factory_diagram.png" alt="DefaultListableBeanFactory"></p>
<p>å¯ä»¥çœ‹å‡ºï¼Œç»§æ‰¿ä½“ç³»ååˆ†åºå¤§ï¼Œç»§æ‰¿äº†å¤šä¸ªæ³¨å†Œå™¨å’Œå®ç°å¤šä¸ªæ¥å£ï¼Œå¸¸ç”¨çš„æ˜¯å•ä¾‹ <code>Singleton</code> æ³¨å†Œå™¨å’Œåˆ«å <code>Alias</code> æ³¨å†Œå™¨ï¼Œè¿™ä¸¤ä¸ªæ¦‚å¿µä¹Ÿå¾ˆåºå¤§ï¼Œå¯ä»¥å…ˆç®€å•ç†Ÿæ‚‰ä¸‹ï¼ŒçŸ¥é“å®¹å™¨é»˜è®¤çš„å¯¹è±¡æ˜¯å•ä¾‹æ¨¡å¼ï¼Œè¿˜æœ‰å¯ä»¥é€šè¿‡åˆ«åæ¥æ‰¾åˆ° <code>bean</code>ï¼Œä¹‹åæœ‰æœºä¼šå†è¯¦ç»†ä»‹ç»å§ã€‚</p>
<hr>
<h4 id="BanFactory-è‡ªå®šä¹‰"><a href="#BanFactory-è‡ªå®šä¹‰" class="headerlink" title="BanFactory è‡ªå®šä¹‰"></a>BanFactory è‡ªå®šä¹‰</h4><p>å…·ä½“æ–¹æ³•å¦‚ä¸‹ï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥å¯¹å·¥å‚è¿›è¡Œå®šåˆ¶åŒ–è®¾ç½®ï¼Œè®©å­ç±»è¿›è¡Œè‡ªç”±é…ç½®ï¼š</p>
<blockquote>
<p>org.springframework.context.support.AbstractRefreshableApplicationContext#customizeBeanFactory</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">customizeBeanFactory</span><span class="params">(DefaultListableBeanFactory beanFactory)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>.allowBeanDefinitionOverriding != <span class="keyword">null</span>) &#123;</span><br><span class="line">		<span class="comment">// é»˜è®¤æ˜¯ falseï¼Œä¸å…è®¸è¦†ç›–</span></span><br><span class="line">		beanFactory.setAllowBeanDefinitionOverriding(<span class="keyword">this</span>.allowBeanDefinitionOverriding);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>.allowCircularReferences != <span class="keyword">null</span>) &#123;</span><br><span class="line">		<span class="comment">// é»˜è®¤æ˜¯ falseï¼Œä¸å…è®¸å¾ªç¯å¼•ç”¨</span></span><br><span class="line">		beanFactory.setAllowCircularReferences(<span class="keyword">this</span>.allowCircularReferences);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="Bean-åŠ è½½å’Œè§£æ"><a href="#Bean-åŠ è½½å’Œè§£æ" class="headerlink" title="Bean åŠ è½½å’Œè§£æ"></a>Bean åŠ è½½å’Œè§£æ</h4><p>æ ¸å¿ƒæ–¹æ³•æ˜¯è¿™ä¸ªï¼š</p>
<blockquote>
<p>org.springframework.context.support.AbstractXmlApplicationContext#loadBeanDefinitions(org.springframework.beans.factory.support.DefaultListableBeanFactory)</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">loadBeanDefinitions</span><span class="params">(DefaultListableBeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException, IOException </span>&#123;</span><br><span class="line">	<span class="comment">// Create a new XmlBeanDefinitionReader for the given BeanFactory.</span></span><br><span class="line">	<span class="comment">// ä¸ºç»™å®šçš„BeanFactoryåˆ›å»ºä¸€ä¸ªæ–°çš„XmlBeanDefinitionReader</span></span><br><span class="line">	XmlBeanDefinitionReader beanDefinitionReader = <span class="keyword">new</span> XmlBeanDefinitionReader(beanFactory);</span><br><span class="line">	<span class="comment">// Configure the bean definition reader with this context's</span></span><br><span class="line">	<span class="comment">// resource loading environment.</span></span><br><span class="line">	beanDefinitionReader.setEnvironment(<span class="keyword">this</span>.getEnvironment());</span><br><span class="line">	beanDefinitionReader.setResourceLoader(<span class="keyword">this</span>);</span><br><span class="line">	beanDefinitionReader.setEntityResolver(<span class="keyword">new</span> ResourceEntityResolver(<span class="keyword">this</span>));</span><br><span class="line">	<span class="comment">// Allow a subclass to provide custom initialization of the reader,</span></span><br><span class="line">	<span class="comment">// then proceed with actually loading the bean definitions.(ç©ºæ–¹æ³•ï¼Œè®©å­ç±»è¿›è¡Œæ‰©å±•å®ç°ï¼‰</span></span><br><span class="line">	initBeanDefinitionReader(beanDefinitionReader);</span><br><span class="line">	loadBeanDefinitions(beanDefinitionReader);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è§£æ <code>XML</code> ä¸­ï¼Œä½¿ç”¨åˆ°ä»¥ä¸‹ä¸¤ä¸ªç»§æ‰¿ä½“ç³»ï¼š<code>EntityResolver</code> å’Œ <code>BeanDefinitionReader</code></p>
<hr>
<h5 id="EntityResolver"><a href="#EntityResolver" class="headerlink" title="EntityResolver"></a>EntityResolver</h5><p><img src="http://img.sevenyuan.cn/entity_resolver_diagram.png" alt="EntityResolver"></p>
<p>æ¥å£å…¨è·¯å¾„æ˜¯ï¼š<code>org.xml.sax.EntityResolver</code>ï¼Œå…·ä½“è§£æä½¿ç”¨çš„æ–¹æ³•æ˜¯:</p>
<blockquote>
<p>org.springframework.beans.factory.xml.ResourceEntityResolver#resolveEntity</p>
</blockquote>
<p>è¯¥æ–¹æ³•æ˜¯ç”¨äºè§£æ <code>schema</code> å’Œ <code>dtd</code>ï¼Œå…·ä½“æ·±ç©¶çš„è¯ä¹Ÿå¾ˆå¤æ‚ï¼Œä½†è§£æ <code>xml</code> ä¸æ˜¯æˆ‘æƒ³äº†è§£çš„ç‚¹ï¼Œæ‰€ä»¥å…ˆè·³è¿‡~</p>
<hr>
<h5 id="BeanDefinitionReader"><a href="#BeanDefinitionReader" class="headerlink" title="BeanDefinitionReader"></a>BeanDefinitionReader</h5><p><img src="http://img.sevenyuan.cn/xml_bean_definition_reader_diagram.png" alt="BeanDefinitionReader"></p>
<p>é¡¶çº§æ¥å£æ˜¯ <code>BeanDefinitionReader</code>ï¼Œç”¨äº <code>XML Bean</code> å®šä¹‰çš„ <code>Bean</code>å®šä¹‰é˜…è¯»å™¨ã€‚å°†å®é™…è¯»å–çš„ <code>XML</code> æ–‡æ¡£å§”æ‰˜ç»™å®ç°ã€‚</p>
<p>è¿™ä¸¤ä¸ªç±»ç”¨é€”å¾ˆæ˜äº†ï¼Œå°±æ˜¯å°† <code>XML</code> è½¬æˆè¾“å…¥æµï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥ç»§ç»­æ·±å…¥è·Ÿè¸ª~</p>
<hr>
<h4 id="é…ç½®æ–‡ä»¶åŠ è½½"><a href="#é…ç½®æ–‡ä»¶åŠ è½½" class="headerlink" title="é…ç½®æ–‡ä»¶åŠ è½½"></a>é…ç½®æ–‡ä»¶åŠ è½½</h4><p>å…¥å£æ–¹æ³•ï¼š(ç”±äºæœ‰å¤šä¸ªé‡åæ–¹æ³•ï¼Œæ‰€ä»¥å¤åˆ¶è·¯å¾„æ—¶ï¼Œå°†å‚æ•°çš„ç±»å‹ä¹Ÿæ‹·è´äº†ï¼‰</p>
<blockquote>
<p>org.springframework.beans.factory.support.AbstractBeanDefinitionReader#loadBeanDefinitions(java.lang.String, java.util.Set&lt;org.springframework.core.io.Resource&gt;)</p>
</blockquote>
<p><strong>æ ¸å¿ƒæ–¹æ³•æ˜¯è¿™ä¸¤è¡Œ</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">loadBeanDefinitions</span><span class="params">(String location, @Nullable Set&lt;Resource&gt; actualResources)</span> <span class="keyword">throws</span> BeanDefinitionStoreException </span>&#123;</span><br><span class="line">    <span class="comment">// è·å–èµ„æºæ–‡ä»¶ï¼ˆèµ„æºåŠ è½½å™¨ä»è·¯å¾„è¯†åˆ«èµ„æºæ–‡ä»¶ï¼‰</span></span><br><span class="line">    Resource[] resources = ((ResourcePatternResolver) resourceLoader).getResources(location)</span><br><span class="line">    <span class="comment">// æ³¨é‡Š 1.6 æ ¹æ®èµ„æºæ–‡ä»¶åŠ è½½ bean</span></span><br><span class="line">    <span class="keyword">int</span> count = loadBeanDefinitions(resources);		</span><br><span class="line">    Â·Â·Â·</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è·å–èµ„æºæ–‡ä»¶åï¼Œå¼€å§‹è§£æèµ„æºæ–‡ä»¶ï¼ˆä¹Ÿå°±æ˜¯ä¸€å¼€å§‹ä¼ å‚çš„ <code>config.xml</code>)ï¼Œå°†å®ƒè½¬æ¢æˆ <code>Document</code></p>
<p>è·Ÿè¸ªä»£ç å¯ä»¥çœ‹åˆ°ï¼Œè¿›è¡Œè§£æçš„èµ„æºæ–‡ä»¶ä» <code>Resource</code> åŒ…è£…æˆ <code>EncodeResouce</code>ï¼Œä¸ºè¾“å…¥æµæ·»åŠ äº†å­—ç¬¦ç¼–ç ï¼ˆé»˜è®¤ä¸º <code>null</code>)ï¼Œä½“ç°äº†è®¾è®¡æ¨¡å¼ - è£…é¥°å™¨æ¨¡å¼</p>
<p>éå†èµ„æºæ–‡ä»¶ï¼Œè¿›è¡Œè½¬æ¢ï¼Œæ ¸å¿ƒæ–¹æ³•æ˜¯ä»¥ä¸‹ä¸¤è¡Œï¼š</p>
<blockquote>
<p>org.springframework.beans.factory.xml.XmlBeanDefinitionReader#loadBeanDefinitions(org.springframework.core.io.support.EncodedResource)</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">loadBeanDefinitions</span><span class="params">(EncodedResource encodedResource)</span> <span class="keyword">throws</span> BeanDefinitionStoreException </span>&#123;</span><br><span class="line">	<span class="comment">// æ³¨é‡Š 1.7 ä»èµ„æºæ–‡ä»¶ä¸­è·å–è¾“å…¥æµ</span></span><br><span class="line">	InputStream inputStream = encodedResource.getResource().getInputStream();</span><br><span class="line">	InputSource inputSource = <span class="keyword">new</span> InputSource(inputStream);</span><br><span class="line">	<span class="keyword">return</span> doLoadBeanDefinitions(inputSource, encodedResource.getResource());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="Bean-è§£æ"><a href="#Bean-è§£æ" class="headerlink" title="Bean è§£æ"></a>Bean è§£æ</h4><blockquote>
<p>org.springframework.beans.factory.xml.XmlBeanDefinitionReader#doLoadBeanDefinitions</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">doLoadBeanDefinitions</span><span class="params">(InputSource inputSource, Resource resource)</span></span></span><br><span class="line"><span class="function">	<span class="keyword">throws</span> BeanDefinitionStoreException </span>&#123;</span><br><span class="line">	<span class="comment">// æ³¨é‡Š 1.8 å°†èµ„æºæ–‡ä»¶è§£ææˆ document</span></span><br><span class="line">	Document doc = doLoadDocument(inputSource, resource);</span><br><span class="line">	<span class="comment">// æ³¨é‡Š 1.10 ä» doc å’Œèµ„æºä¸­è§£æå…ƒç´ ï¼Œæ³¨å†Œåˆ° bean factory</span></span><br><span class="line">	<span class="keyword">int</span> count = registerBeanDefinitions(doc, resource);</span><br><span class="line">	<span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">		logger.debug(<span class="string">"Loaded "</span> + count + <span class="string">" bean definitions from "</span> + resource);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ <code>doLoadDocument()</code> æ–¹æ³•ä¸­ï¼Œå°†èµ„æºæ–‡ä»¶è§£ææˆ <code>docuemnt</code> æ–‡æ¡£</p>
<blockquote>
<p>org.springframework.beans.factory.xml.XmlBeanDefinitionReader#registerBeanDefinitions</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">registerBeanDefinitions</span><span class="params">(Document doc, Resource resource)</span> <span class="keyword">throws</span> BeanDefinitionStoreException </span>&#123;</span><br><span class="line">	<span class="comment">// ä½¿ç”¨ DefaultBeanDefinitionDocumentReader å®ä¾‹åŒ– BeanDefinitionDocumentReader</span></span><br><span class="line">	BeanDefinitionDocumentReader documentReader = createBeanDefinitionDocumentReader();</span><br><span class="line">	<span class="comment">// è®°å½•ç»Ÿè®¡å‰ beanDefinition çš„åŠ è½½ä¸ªæ•°</span></span><br><span class="line">	<span class="keyword">int</span> countBefore = getRegistry().getBeanDefinitionCount();</span><br><span class="line">	<span class="comment">// åŠ è½½åŠæ³¨å†Œ beanï¼Œè¿™é‡Œä½¿ç”¨æ³¨å†Œå·¥å‚çš„æ˜¯ DefaultListableBeanFactory</span></span><br><span class="line">	documentReader.registerBeanDefinitions(doc, createReaderContext(resource));</span><br><span class="line">	<span class="comment">// è®°å½•æœ¬æ¬¡åŠ è½½çš„ BeanDefinition ä¸ªæ•°ï¼ˆæ–°å€¼ - æ—§å€¼ï¼‰</span></span><br><span class="line">	<span class="keyword">return</span> getRegistry().getBeanDefinitionCount() - countBefore;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä¸å¤šä»‹ç»å¦‚ä½•è½¬æ¢æˆ <code>document</code> å’Œ <code>documentReader</code> åˆå§‹åŒ–ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦è¯·ç»§ç»­è·Ÿè¸ª~</p>
<p>ä¸‹é¢è¦è¯´çš„æ˜¯ <code>bean</code> å®¹å™¨ <code>DefaultListableBeanFactory</code> è§£æ <code>document</code></p>
<blockquote>
<p>org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReader#doRegisterBeanDefinitions</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doRegisterBeanDefinitions</span><span class="params">(Element root)</span> </span>&#123;</span><br><span class="line">	BeanDefinitionParserDelegate parent = <span class="keyword">this</span>.delegate;</span><br><span class="line">	<span class="keyword">this</span>.delegate = createDelegate(getReaderContext(), root, parent);</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>.delegate.isDefaultNamespace(root)) &#123;</span><br><span class="line">		String profileSpec = root.getAttribute(PROFILE_ATTRIBUTE);</span><br><span class="line">		<span class="keyword">if</span> (StringUtils.hasText(profileSpec)) &#123;</span><br><span class="line">			String[] specifiedProfiles = StringUtils.tokenizeToStringArray(</span><br><span class="line">					profileSpec, BeanDefinitionParserDelegate.MULTI_VALUE_ATTRIBUTE_DELIMITERS);</span><br><span class="line">			<span class="comment">// We cannot use Profiles.of(...) since profile expressions are not supported</span></span><br><span class="line">			<span class="comment">// in XML config. See SPR-12458 for details.</span></span><br><span class="line">			<span class="keyword">if</span> (!getReaderContext().getEnvironment().acceptsProfiles(specifiedProfiles)) &#123;</span><br><span class="line">				<span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">					logger.debug(<span class="string">"Skipped XML bean definition file due to specified profiles ["</span> + profileSpec +</span><br><span class="line">							<span class="string">"] not matching: "</span> + getReaderContext().getResource());</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">return</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// preProcess å’Œ postProcess ç‚¹è¿›å»ä¼šå‘ç°æ˜¯ç©ºæ–¹æ³•ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•ç•™ç»™å­ç±»é‡è½½ï¼Œä½“ç°äº†è®¾è®¡æ¨¡å¼ - æ¨¡æ¿æ–¹æ³•</span></span><br><span class="line">	preProcessXml(root);</span><br><span class="line">	<span class="comment">// æ³¨é‡Š 1.11 æ ¸å¿ƒæ–¹æ³•ï¼Œè§£æ doc å…ƒç´ </span></span><br><span class="line">	parseBeanDefinitions(root, <span class="keyword">this</span>.delegate);</span><br><span class="line">	postProcessXml(root);</span><br><span class="line">	<span class="keyword">this</span>.delegate = parent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œåœ¨è§£æä¹‹å‰ï¼Œå¦‚æœå‘½åç©ºé—´æ˜¯ä»¥ <code>http://www.springframework.org/schema/beans</code> å¼€å¤´ï¼Œå°†ä¼šæ£€æŸ¥ <code>profile</code> å±æ€§</p>
<p>æ ¡éªŒé€šè¿‡åï¼Œå¼€å§‹æ­£å¼è§£æ <code>doc</code> å…ƒç´ </p>
<blockquote>
<p>org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReader#parseBeanDefinitions<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">parseBeanDefinitions</span><span class="params">(Element root, BeanDefinitionParserDelegate delegate)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (delegate.isDefaultNamespace(root)) &#123;</span><br><span class="line">		<span class="comment">// æ³¨é‡Š 1.12 éå† doc ä¸­çš„èŠ‚ç‚¹åˆ—è¡¨</span></span><br><span class="line">		NodeList nl = root.getChildNodes();</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nl.getLength(); i++) &#123;</span><br><span class="line">			Node node = nl.item(i);</span><br><span class="line">			<span class="keyword">if</span> (node <span class="keyword">instanceof</span> Element) &#123;</span><br><span class="line">				Element ele = (Element) node;</span><br><span class="line">				<span class="keyword">if</span> (delegate.isDefaultNamespace(ele)) &#123;</span><br><span class="line">					<span class="comment">// æ³¨é‡Š 1.13 è¯†åˆ«å‡ºé»˜è®¤æ ‡ç­¾çš„ bean æ³¨å†Œ</span></span><br><span class="line">					<span class="comment">// æ ¹æ®å…ƒç´ åç§°ï¼Œè°ƒç”¨ä¸åŒçš„åŠ è½½æ–¹æ³•ï¼Œæ³¨å†Œ bean</span></span><br><span class="line">					parseDefaultElement(ele, delegate);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> &#123;</span><br><span class="line">					delegate.parseCustomElement(ele);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		delegate.parseCustomElement(root);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬åœ¨ <code>xml</code> ä¸­é…ç½®çš„å±æ€§å°±èƒ½å¯¹åº”åˆ° <code>document</code> å¯¹è±¡ä¸­ï¼Œåœ¨ä¹‹åæµç¨‹ä¸­å–å‡ºä½¿ç”¨</p>
<hr>
<h4 id="é»˜è®¤æ ‡ç­¾è§£æ"><a href="#é»˜è®¤æ ‡ç­¾è§£æ" class="headerlink" title="é»˜è®¤æ ‡ç­¾è§£æ"></a>é»˜è®¤æ ‡ç­¾è§£æ</h4><p>è¿™éƒ¨åˆ†ä¸ä¼šç»†è¯´ï¼Œä¹‹åå†å†™ä¸€ç¯‡è¿›è¡Œè¡¥å……ï¼Œæ‰€ä»¥ç®€å•çš„è¿‡ä¸‹ä»£ç ä¸­ï¼Œæ˜¯å¦‚ä½•è§£æé»˜è®¤æ ‡ç­¾çš„</p>
<ul>
<li><strong>IMPORT</strong>ï¼šå¯¼å…¥æ ‡ç­¾</li>
<li><strong>ALIAS</strong>ï¼šåˆ«åæ ‡ç­¾</li>
<li><strong>BEAN</strong>ï¼š<code>bean</code> æ ‡ç­¾</li>
<li><strong>NESTED_BEANS</strong>ï¼š<code>beans</code> æ ‡ç­¾ï¼ˆåµŒå¥—çš„ <code>beans</code>)</li>
</ul>
<blockquote>
<p>org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReader#parseDefaultElement</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">parseDefaultElement</span><span class="params">(Element ele, BeanDefinitionParserDelegate delegate)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (delegate.nodeNameEquals(ele, IMPORT_ELEMENT)) &#123;</span><br><span class="line">		importBeanDefinitionResource(ele);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (delegate.nodeNameEquals(ele, ALIAS_ELEMENT)) &#123;</span><br><span class="line">		processAliasRegistration(ele);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (delegate.nodeNameEquals(ele, BEAN_ELEMENT)) &#123;</span><br><span class="line">		processBeanDefinition(ele, delegate);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (delegate.nodeNameEquals(ele, NESTED_BEANS_ELEMENT)) &#123;</span><br><span class="line">		<span class="comment">// recurse</span></span><br><span class="line">		doRegisterBeanDefinitions(ele);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è®©æˆ‘ä»¬æ¥çœ‹ä¸‹å¦‚ä½•è§£æ <code>bean</code> æ ‡ç­¾</p>
<hr>
<h5 id="bean-æ ‡ç­¾è§£æ"><a href="#bean-æ ‡ç­¾è§£æ" class="headerlink" title="bean æ ‡ç­¾è§£æ"></a>bean æ ‡ç­¾è§£æ</h5><blockquote>
<p>org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReader#processBeanDefinition</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">processBeanDefinition</span><span class="params">(Element ele, BeanDefinitionParserDelegate delegate)</span> </span>&#123;</span><br><span class="line">	<span class="comment">// æ³¨é‡Š 1.15 è§£æ bean åç§°çš„å…ƒç´ </span></span><br><span class="line">	BeanDefinitionHolder bdHolder = delegate.parseBeanDefinitionElement(ele);</span><br><span class="line">	<span class="keyword">if</span> (bdHolder != <span class="keyword">null</span>) &#123;</span><br><span class="line">		bdHolder = delegate.decorateBeanDefinitionIfRequired(ele, bdHolder);</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// Register the final decorated instance. ï¼ˆæ³¨é‡Š 1.16 æ³¨å†Œæœ€åä¿®é¥°åçš„å®ä¾‹ï¼‰</span></span><br><span class="line">			BeanDefinitionReaderUtils.registerBeanDefinition(bdHolder, getReaderContext().getRegistry());</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">catch</span> (BeanDefinitionStoreException ex) &#123;</span><br><span class="line">			getReaderContext().error(<span class="string">"Failed to register bean definition with name '"</span> +</span><br><span class="line">					bdHolder.getBeanName() + <span class="string">"'"</span>, ele, ex);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// Send registration event.</span></span><br><span class="line">		getReaderContext().fireComponentRegistered(<span class="keyword">new</span> BeanComponentDefinition(bdHolder));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢è®²ä¸‹å‡ ä¸ªå…³é”®æ–¹æ³•æ‰€åšçš„äº‹æƒ…</p>
<hr>
<h5 id="è·å–-id-å’Œ-name"><a href="#è·å–-id-å’Œ-name" class="headerlink" title="è·å– id å’Œ name"></a>è·å– id å’Œ name</h5><blockquote>
<p>org.springframework.beans.factory.xml.BeanDefinitionParserDelegate#parseBeanDefinitionElement(org.w3c.dom.Element, org.springframework.beans.factory.config.BeanDefinition)</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> BeanDefinitionHolder <span class="title">parseBeanDefinitionElement</span><span class="params">(Element ele, @Nullable BeanDefinition containingBean)</span> </span>&#123;</span><br><span class="line">	<span class="comment">// è·å– ID å±æ€§</span></span><br><span class="line">	String id = ele.getAttribute(ID_ATTRIBUTE);</span><br><span class="line">	<span class="comment">// è·å– NAME å±æ€§</span></span><br><span class="line">	String nameAttr = ele.getAttribute(NAME_ATTRIBUTE);</span><br><span class="line">	List&lt;String&gt; aliases = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">	<span class="keyword">if</span> (StringUtils.hasLength(nameAttr)) &#123;</span><br><span class="line">		<span class="comment">// åç§°æŒ‰ç…§ , ; è¿›è¡Œåˆ†å‰²</span></span><br><span class="line">		String[] nameArr = StringUtils.tokenizeToStringArray(nameAttr, MULTI_VALUE_ATTRIBUTE_DELIMITERS);</span><br><span class="line">		aliases.addAll(Arrays.asList(nameArr));</span><br><span class="line">	&#125;</span><br><span class="line">	String beanName = id;</span><br><span class="line">	<span class="keyword">if</span> (!StringUtils.hasText(beanName) &amp;&amp; !aliases.isEmpty()) &#123;</span><br><span class="line">		<span class="comment">// å¦‚æœæ²¡æœ‰æŒ‡å®š idï¼Œå°† name çš„ç¬¬ä¸€ä¸ªå€¼ä½œä¸º id</span></span><br><span class="line">		beanName = aliases.remove(<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// é»˜è®¤ null</span></span><br><span class="line">	<span class="keyword">if</span> (containingBean == <span class="keyword">null</span>) &#123;</span><br><span class="line">		<span class="comment">// æ£€æŸ¥åå­—æ˜¯å¦å”¯ä¸€ï¼Œå¦‚æœ id é‡å¤äº†ï¼Œå°†æŠ›å‡ºé”™è¯¯</span></span><br><span class="line">		<span class="comment">// å†…éƒ¨ usedNames æ˜¯ä¸€ä¸ª HashSetï¼Œå°†ä¼šå­˜å‚¨åŠ è½½è¿‡çš„ name å’Œ aliases</span></span><br><span class="line">		checkNameUniqueness(beanName, aliases, ele);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// å°†å…¬å…±å±æ€§æ”¾å…¥ AbstractBeanDefinitionï¼Œå…·ä½“å®ç°åœ¨å­ç±» GenericBeanDefinition</span></span><br><span class="line">	AbstractBeanDefinition beanDefinition = parseBeanDefinitionElement(ele, beanName, containingBean);</span><br><span class="line">	<span class="keyword">if</span> (beanDefinition != <span class="keyword">null</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!StringUtils.hasText(beanName)) &#123;</span><br><span class="line">			<span class="keyword">if</span> (containingBean != <span class="keyword">null</span>) &#123;</span><br><span class="line">				<span class="comment">// å¦‚æœ id å’Œ name éƒ½æ˜¯ç©ºï¼Œé‚£ä¸ª spring ä¼šç»™å®ƒç”Ÿæˆä¸€ä¸ªé»˜è®¤çš„åç§°</span></span><br><span class="line">				beanName = BeanDefinitionReaderUtils.generateBeanName(</span><br><span class="line">						beanDefinition, <span class="keyword">this</span>.readerContext.getRegistry(), <span class="keyword">true</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				beanName = <span class="keyword">this</span>.readerContext.generateBeanName(beanDefinition);</span><br><span class="line">				String beanClassName = beanDefinition.getBeanClassName();</span><br><span class="line">				<span class="keyword">if</span> (beanClassName != <span class="keyword">null</span> &amp;&amp;</span><br><span class="line">						beanName.startsWith(beanClassName) &amp;&amp; beanName.length() &gt; beanClassName.length() &amp;&amp;</span><br><span class="line">						!<span class="keyword">this</span>.readerContext.getRegistry().isBeanNameInUse(beanClassName)) &#123;</span><br><span class="line">					aliases.add(beanClassName);</span><br><span class="line">				    &#125;</span><br><span class="line">			    &#125;</span><br><span class="line">		    &#125;</span><br><span class="line">		&#125;</span><br><span class="line">		String[] aliasesArray = StringUtils.toStringArray(aliases);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> BeanDefinitionHolder(beanDefinition, beanName, aliasesArray);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è·å– <code>id</code> å’Œ <code>name</code> å±æ€§çš„æµç¨‹ï¼ŒæŒ‰ç…§ä»£ç æ³¨é‡Šä¸€æ­¥ä¸€æ­¥å¾€ä¸‹èµ°å°±æ¸…æ™°äº†</p>
<p>è¯¥æ–¹æ³•ä¸»è¦å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>æå–å…ƒç´ ä¸­çš„ <code>id</code> <code>name</code> å±æ€§</strong></li>
<li><strong>è¿›ä¸€æ­¥è§£æå…¶å®ƒæ‰€æœ‰å±æ€§å¹¶ç»Ÿä¸€å°è£…åˆ° <code>GenericBeanDefinition</code> ç±»å‹çš„å®ä¾‹ä¸­</strong></li>
<li><strong>æ£€æµ‹åˆ° <code>bean</code> æ²¡æœ‰æŒ‡å®š <code>beanName</code></strong> ä½¿ç”¨é»˜è®¤è§„åˆ™ç”Ÿæˆ <code>beanName</code></li>
<li><strong>å°†è·å–åˆ°çš„ä¿¡æ¯å°è£…åˆ° <code>BeanDefinitionHolder</code> çš„å®ä¾‹ä¸­</strong></li>
</ul>
<hr>
<h5 id="å¯¹æ ‡ç­¾ä¸­å…¶å®ƒå±æ€§çš„è§£æ"><a href="#å¯¹æ ‡ç­¾ä¸­å…¶å®ƒå±æ€§çš„è§£æ" class="headerlink" title="å¯¹æ ‡ç­¾ä¸­å…¶å®ƒå±æ€§çš„è§£æ"></a>å¯¹æ ‡ç­¾ä¸­å…¶å®ƒå±æ€§çš„è§£æ</h5><blockquote>
<p>org.springframework.beans.factory.xml.BeanDefinitionParserDelegate#parseBeanDefinitionElement(org.w3c.dom.Element, java.lang.String, org.springframework.beans.factory.config.BeanDefinition)</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> AbstractBeanDefinition <span class="title">parseBeanDefinitionElement</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">		Element ele, String beanName, @Nullable BeanDefinition containingBean)</span> </span>&#123;</span><br><span class="line">    AbstractBeanDefinition bd = createBeanDefinition(className, parent);</span><br><span class="line">    parseBeanDefinitionAttributes(ele, beanName, containingBean, bd);</span><br><span class="line">    bd.setDescription(DomUtils.getChildElementValueByTagName(ele, DESCRIPTION_ELEMENT));</span><br><span class="line">    parseMetaElements(ele, bd);</span><br><span class="line">    parseLookupOverrideSubElements(ele, bd.getMethodOverrides());</span><br><span class="line">    parseReplacedMethodSubElements(ele, bd.getMethodOverrides());</span><br><span class="line">    parseConstructorArgElements(ele, bd);</span><br><span class="line">    parsePropertyElements(ele, bd);</span><br><span class="line">    parseQualifierElements(ele, bd);</span><br><span class="line">    bd.setResource(<span class="keyword">this</span>.readerContext.getResource());</span><br><span class="line">    bd.setSource(extractSource(ele));</span><br><span class="line">    <span class="keyword">return</span> bd;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆå§‹åŒ– <code>BeanDefiniton</code> åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼š(å…·ä½“å®ç°æ˜¯å®ƒçš„å­ç±» <code>GenericBeanDefinition</code> å™¢~ï¼‰</p>
<blockquote>
<p>BeanDefinitionReaderUtils.createBeanDefinition(parentName, className, this.readerContext.getBeanClassLoader())</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> AbstractBeanDefinition <span class="title">createBeanDefinition</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">			@Nullable String parentName, @Nullable String className, @Nullable ClassLoader classLoader)</span> <span class="keyword">throws</span> ClassNotFoundException </span>&#123;</span><br><span class="line">	GenericBeanDefinition bd = <span class="keyword">new</span> GenericBeanDefinition();</span><br><span class="line">	bd.setParentName(parentName);</span><br><span class="line">	<span class="keyword">if</span> (className != <span class="keyword">null</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (classLoader != <span class="keyword">null</span>) &#123;</span><br><span class="line">			bd.setBeanClass(ClassUtils.forName(className, classLoader));</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			bd.setBeanClassName(className);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> bd;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åé¢å°±æ˜¯è§£æå…¶å®ƒæ ‡ç­¾çš„å†…å®¹ï¼Œä¹‹åä¼šè¡¥å‘~</p>
<hr>
<h5 id="BeanDefinition-ç»§æ‰¿ä½“ç³»"><a href="#BeanDefinition-ç»§æ‰¿ä½“ç³»" class="headerlink" title="BeanDefinition ç»§æ‰¿ä½“ç³»"></a>BeanDefinition ç»§æ‰¿ä½“ç³»</h5><p><img src="http://img.sevenyuan.cn/generic_bean_definition_diagram.png" alt="GenericBeanDefinition"></p>
<p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œ<code>BeanDefinition</code> æ˜¯ä¸€ä¸ªæ¥å£ï¼Œ<code>GenericBeanDefinition</code> ã€<code>RootBeanDefinition</code>ã€<code>ChildBeanDefinition</code>ï¼Œè¿™ä¸‰è€…éƒ½ç»§æ‰¿äº† <code>AbstractBeanDefinition</code>ã€‚</p>
<p>å…¶ä¸­ <code>BeanDefinition</code> æ˜¯é…ç½®æ–‡ä»¶ <code>&lt;bean&gt;</code> å…ƒç´ æ ‡ç­¾åœ¨å®¹å™¨ä¸­çš„å†…éƒ¨è¡¨ç¤ºå½¢å¼ã€‚</p>
<p><code>&lt;bean&gt;</code> å…ƒç´ æ ‡ç­¾æ‹¥æœ‰ <code>class</code>ã€ <code>scope</code>ã€ <code>lazy-init</code> ç­‰é…ç½®å±æ€§ï¼Œ<code>BeanDefinition</code> åˆ™æä¾›äº†ç›¸åº”çš„ <code>beanClass</code>ã€ <code>scope</code>ã€<code>lazyInit</code> å±æ€§ï¼Œä¸¤è€…æ˜¯äº’ç›¸å¯¹åº”çš„ã€‚</p>
<hr>
<h5 id="BeanDefinitionHolder-ä¿®é¥°"><a href="#BeanDefinitionHolder-ä¿®é¥°" class="headerlink" title="BeanDefinitionHolder ä¿®é¥°"></a>BeanDefinitionHolder ä¿®é¥°</h5><blockquote>
<p>org.springframework.beans.factory.xml.BeanDefinitionParserDelegate#decorateBeanDefinitionIfRequired(org.w3c.dom.Element, org.springframework.beans.factory.config.BeanDefinitionHolder, org.springframework.beans.factory.config.BeanDefinition)</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> BeanDefinitionHolder <span class="title">decorateBeanDefinitionIfRequired</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">			Element ele, BeanDefinitionHolder definitionHolder, @Nullable BeanDefinition containingBd)</span> </span>&#123;</span><br><span class="line">	<span class="comment">// æ–¹æ³•ä¸­çš„ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯çˆ¶ç±» bean</span></span><br><span class="line">	<span class="comment">// å½“å¯¹æŸä¸ªåµŒå¥—é…ç½®è¿›è¡Œåˆ†ææ—¶ï¼Œè¿™é‡Œéœ€è¦ä¼ é€’ï¼Œæ˜¯ä¸ºäº†ä½¿ç”¨çˆ¶ç±»çš„ scope å±æ€§ï¼Œä»¥å¤‡å­ç±»æ²¡è®¾å®š scopeï¼Œå¯ä»¥ä½¿ç”¨çˆ¶ç±»çš„ scope å±æ€§</span></span><br><span class="line">	BeanDefinitionHolder finalDefinition = definitionHolder;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Decorate based on custom attributes first.</span></span><br><span class="line">	NamedNodeMap attributes = ele.getAttributes();</span><br><span class="line">	<span class="comment">// éå†æ‰€æœ‰çš„å±æ€§ï¼Œè¿›è¡Œå±æ€§çš„ä¿®é¥°</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; attributes.getLength(); i++) &#123;</span><br><span class="line">		Node node = attributes.item(i);</span><br><span class="line">		finalDefinition = decorateIfRequired(node, finalDefinition, containingBd);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Decorate based on custom nested elements.</span></span><br><span class="line">	NodeList children = ele.getChildNodes();</span><br><span class="line">	<span class="comment">// éå†æ‰€æœ‰çš„å­èŠ‚ç‚¹ï¼Œä¿®é¥°å­å…ƒç´ </span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; children.getLength(); i++) &#123;</span><br><span class="line">		Node node = children.item(i);</span><br><span class="line">		<span class="keyword">if</span> (node.getNodeType() == Node.ELEMENT_NODE) &#123;</span><br><span class="line">			finalDefinition = decorateIfRequired(node, finalDefinition, containingBd);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> finalDefinition;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¹‹å‰çš„å¸¸è§„å±æ€§è§£æåï¼Œåœ¨è¿™ä¸€æ­¥æ“ä½œä¸­ï¼Œä¸»è¦ç”¨æ¥å®Œæˆè‡ªå®šä¹‰æ ‡ç­¾å…ƒç´ çš„è§£æï¼Œè¿™é‡Œç»§ç»­ç•™ä¸ªå‘~</p>
<hr>
<h5 id="Bean-æ³¨å†Œ"><a href="#Bean-æ³¨å†Œ" class="headerlink" title="Bean æ³¨å†Œ"></a>Bean æ³¨å†Œ</h5><p>ç»å†åƒè¾›ä¸‡è‹¦ï¼Œé€šè¿‡ä¸Šé¢ä¸€äº›åˆ—çš„è§£ææ“ä½œï¼Œç»ˆäºåˆ°äº†æ³¨å†Œ <code>bean</code> ä¿¡æ¯çš„æ–¹æ³•</p>
<blockquote>
<p>org.springframework.beans.factory.support.BeanDefinitionReaderUtils#registerBeanDefinition</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">registerBeanDefinition</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">			BeanDefinitionHolder definitionHolder, BeanDefinitionRegistry registry)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> BeanDefinitionStoreException </span>&#123;</span><br><span class="line">		<span class="comment">// Register bean definition under primary name.</span></span><br><span class="line">		<span class="comment">// æ³¨é‡Š 1.17 åœ¨ DefaultListableBeanFactory çš„ beanDefinitionMap ä¸­æ·»åŠ  bean å®šä¹‰</span></span><br><span class="line">		String beanName = definitionHolder.getBeanName();</span><br><span class="line">		registry.registerBeanDefinition(beanName, definitionHolder.getBeanDefinition());</span><br><span class="line">		<span class="comment">// Register aliases for bean name, if any.</span></span><br><span class="line">		String[] aliases = definitionHolder.getAliases();</span><br><span class="line">		<span class="keyword">if</span> (aliases != <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">for</span> (String alias : aliases) &#123;</span><br><span class="line">				registry.registerAlias(beanName, alias);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä¹Ÿè¯´è¿‡ï¼Œè¿™é‡Œä½¿ç”¨çš„ <code>bean</code> å®¹å™¨æ˜¯ <code>DefaultListableBeanFactory</code>ï¼Œæ³¨å†Œæ–¹æ³•å…³é”®æ“ä½œæ—¶ä»¥ä¸‹ä¸¤è¡Œä»£ç ï¼š</p>
<blockquote>
<p>org.springframework.beans.factory.support.DefaultListableBeanFactory#registerBeanDefinition</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerBeanDefinition</span><span class="params">(String beanName, BeanDefinition beanDefinition)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.beanDefinitionMap.put(beanName, beanDefinition);</span><br><span class="line">	<span class="keyword">this</span>.beanDefinitionNames.add(beanName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>åˆ°äº†è¿™ä¸€æ­¥ï¼Œå°† <code>bean</code> ä¿¡æ¯æ”¾å…¥åˆ° <code>beanDefinitionMap</code>ï¼Œå®Œæˆäº†ç±»æ³¨å†Œçš„æ“ä½œ~</strong></p>
<p>ä¸ºäº†æè¿°ä»£ç é€»è¾‘çš„å®Œæ•´æ€§ï¼Œå¯¹ä»¥ä¸‹ä¸€äº›æ–¹æ³•è¿›è¡Œç®€å•ä»‹ç»ã€‚</p>
<hr>
<h3 id="prepareBeanFactory"><a href="#prepareBeanFactory" class="headerlink" title="prepareBeanFactory"></a>prepareBeanFactory</h3><p>å‡†å¤‡ç±»åŠ è½½å™¨çš„ç¯å¢ƒï¼Œå¯¹å‰é¢è·å–åˆ°çš„ <code>beanFactory(ConfigurationListableBeanFactory)</code> è¿›è¡Œç›¸å…³çš„è®¾ç½®ï¼ŒåŒ…æ‹¬ <code>ClassLoader</code>, <code>post-processors</code>ç­‰</p>
<hr>
<h4 id="postProcessBeanFactory"><a href="#postProcessBeanFactory" class="headerlink" title="postProcessBeanFactory"></a>postProcessBeanFactory</h4><p>å°†åŠ è½½æ‰€æœ‰ <code>bean</code> å®šä¹‰ï¼Œä½†è¿˜æ²¡æœ‰å®ä¾‹åŒ– <code>bean</code> æ—¶ï¼Œåœ¨åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡çš„æ ‡å‡†åˆå§‹åŒ–ä¹‹åä¿®æ”¹å®ƒçš„å†…éƒ¨ <code>bean</code> å®¹å™¨ã€‚</p>
<p>è¿™å…è®¸åœ¨ç‰¹å®šçš„ <code>ApplicationContext</code> å®ç°ä¸­æ³¨å†Œç‰¹æ®Šçš„ <code>beanpostprocessor</code> ç­‰ã€‚</p>
<p>è¿™ä¹Ÿæ˜¯ä¸€ä¸ªç©ºæ–¹æ³•ï¼Œç­‰å­ç±»å»å®ç°</p>
<hr>
<h4 id="invokeBeanFactoryPostProcessors"><a href="#invokeBeanFactoryPostProcessors" class="headerlink" title="invokeBeanFactoryPostProcessors"></a>invokeBeanFactoryPostProcessors</h4><p>å®ä¾‹åŒ–å¹¶è°ƒç”¨æ‰€æœ‰æ³¨å†Œçš„ <code>BeanFactoryPostProcessorBean</code>ï¼Œè¿™äº›æ˜¯åå¤„ç†å™¨ï¼Œå¤„ç†ç±»å‹æ˜¯ <code>BeanFactory</code>, <code>Spring</code> å®¹å™¨å…è®¸åœ¨å®ä¾‹åŒ– <code>bean</code> å‰ï¼Œè¯»å– <code>bean</code> ä¿¡æ¯å’Œä¿®æ”¹å®ƒçš„å±æ€§ã€‚</p>
<p>ç›¸å½“äºåœ¨å®ä¾‹åŒ–å‰ï¼Œç»™ç”¨æˆ·æœ€åä¸€æ¬¡æœºä¼šå»ä¿®æ”¹ <code>bean</code> ä¿¡æ¯ã€‚</p>
<p>è¿˜æœ‰ä¸€ç‚¹ï¼Œæ‰§è¡Œä¹Ÿå¯ä»¥æœ‰å…ˆåé¡ºåºï¼Œä¾æ®è¿™äº›å¤„ç†å™¨æ˜¯å¦å®ç° <code>PriorityOrdered</code> ã€<code>Order</code> æ¥å£ï¼Œæ ¹æ® <code>order</code> å€¼è¿›è¡Œæ’åºã€‚</p>
<hr>
<h4 id="registerBeanPostProcessors"><a href="#registerBeanPostProcessors" class="headerlink" title="registerBeanPostProcessors"></a>registerBeanPostProcessors</h4><p>å®ä¾‹åŒ–å¹¶æ³¨å†Œæ‰€æœ‰åå¤„ç†å™¨ï¼Œè·Ÿä¸Šé¢çš„ä¸ä¸€æ ·ï¼Œè¿™ä¸ªæ–¹æ³•å¤„ç†çš„ç±»å‹æ˜¯ <code>Bean</code> ï¼Œè·Ÿä¸Šé¢æ–¹æ³•ä¸€æ ·çš„æ˜¯ï¼Œä¹Ÿæœ‰ä¼˜å…ˆçº§çš„æ¦‚å¿µ~</p>
<hr>
<h4 id="initMessageSource"><a href="#initMessageSource" class="headerlink" title="initMessageSource"></a>initMessageSource</h4><p>åˆå§‹åŒ–æ­¤ä¸Šä¸‹æ–‡çš„æ¶ˆæ¯æº</p>
<hr>
<h4 id="initApplicationEventMulticaster"><a href="#initApplicationEventMulticaster" class="headerlink" title="initApplicationEventMulticaster"></a>initApplicationEventMulticaster</h4><p>åˆå§‹åŒ–æ­¤ä¸Šä¸‹æ–‡çš„äº‹ä»¶å¤šæ’­ç¨‹åº</p>
<hr>
<h4 id="onRefresh"><a href="#onRefresh" class="headerlink" title="onRefresh"></a>onRefresh</h4><p>æ¨¡æ¿æ–¹æ³•ï¼Œå¯è¢«é‡å†™ä»¥æ·»åŠ ç‰¹å®šäºä¸Šä¸‹æ–‡çš„åˆ·æ–°å·¥ä½œã€‚</p>
<p>åœ¨å®ä¾‹åŒ–å•ä¾‹ä¹‹å‰è°ƒç”¨ç‰¹æ®Š <code>bean</code> çš„åˆå§‹åŒ–ã€‚(é›¾ï¼Œä¸çŸ¥é“æ˜¯å•¥ç‰¹æ®Š <code>bean</code> ï¼Œç•™ä¸ªå‘=-=ï¼‰</p>
<p>æ­¤å®ç°ä¸ºç©ºã€‚</p>
<hr>
<h4 id="registerListeners"><a href="#registerListeners" class="headerlink" title="registerListeners"></a>registerListeners</h4><p>æ£€æŸ¥ä¾¦å¬å™¨ <code>bean</code> å¹¶æ³¨å†Œå®ƒä»¬</p>
<p>äº‹ä»¶ç›‘å¬è€…ç±»å‹æ˜¯ <code>java.util.EventListener</code></p>
<hr>
<h4 id="finishBeanFactoryInitialization"><a href="#finishBeanFactoryInitialization" class="headerlink" title="finishBeanFactoryInitialization"></a>finishBeanFactoryInitialization</h4><p>å®Œæˆ <code>bean</code> å®¹å™¨çš„åˆå§‹åŒ–ï¼Œå®ä¾‹åŒ–æ‰€æœ‰å‰©ä½™çš„(éæƒ°æ€§åˆå§‹åŒ–)å•ä¾‹</p>
<hr>
<h4 id="finishRefresh"><a href="#finishRefresh" class="headerlink" title="finishRefresh"></a>finishRefresh</h4><p>æœ€åä¸€æ­¥ï¼Œå‘å¸ƒç›¸åº”çš„äº‹ä»¶</p>
<p>äº‹ä»¶çš„ç±»å‹æ˜¯ï¼š<code>java.util.EventObject</code></p>
<hr>
<h4 id="resetCommonCaches"><a href="#resetCommonCaches" class="headerlink" title="resetCommonCaches"></a>resetCommonCaches</h4><p>çœŸçœŸæ³¨å†Œçš„æœ€åä¸€æ­¥ï¼Œç”¨æ¥æ¸…é™¤ç¼“å­˜</p>
<blockquote>
<p>é‡ç½® <code>Spring</code> æ ¸å¿ƒä¸­çš„å…¬å…±å†…çœç¼“å­˜ï¼Œå› ä¸ºæˆ‘ä»¬å¯èƒ½å†ä¹Ÿä¸éœ€è¦å•ä¾‹ <code>bean</code> çš„å…ƒæ•°æ®äº†</p>
</blockquote>
<hr>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ¬ç« ç¬”è®°åªæ˜¯è®°å½•äº†ä¸€ä¸ª <code>bean</code> å¦‚ä½•ä» <code>xml</code> åŠ è½½åˆ° <code>bean</code> å®¹å™¨çš„æ³¨å†Œè¡¨ä¸­ï¼Œç»å†äº†å¤šè¡Œä»£ç ï¼Œç»ˆäºæ‘¸æ¸…è°ƒç”¨é“¾è·¯ã€‚</p>
<p>è¿™é‡Œæ€»ç»“ä¸€ä¸‹æ ¸å¿ƒçš„ <code>loadBeanDefinitions(beanFactory)</code> å·¥ä½œæµç¨‹ï¼š</p>
<p>â‘  è¯»å–é…ç½®æ–‡ä»¶</p>
<ul>
<li><strong>å°è£…èµ„æºæ–‡ä»¶</strong>ï¼šè·å–è·¯å¾„æ–‡ä»¶ï¼Œå°è£…æˆ <code>EncodeResource</code> </li>
<li><strong>è·å–è¾“å…¥æµ</strong>ï¼šä» <code>Resource</code> ä¸­è·å–å¯¹åº”çš„ <code>InputStream</code> å¹¶æ„é€  <code>InputSource</code></li>
<li><strong>ä¼ é€’å‚æ•°</strong>ï¼šé€šè¿‡æ„é€ çš„ <code>InputSource</code> å®ä¾‹å’Œ <code>Resource</code> å®ä¾‹ï¼Œä¼ é€’ç»™ <code>doLoadBeanDefinitions</code> æ–¹æ³•</li>
</ul>
<p>â‘¡ åŠ è½½ <code>bean</code></p>
<ul>
<li><strong>è·å–å¯¹ <code>XML</code> èµ„æºæ–‡ä»¶çš„éªŒè¯æ¨¡å¼</strong></li>
<li><strong>åŠ è½½ <code>XML</code> èµ„æºæ–‡ä»¶ï¼Œè§£ææˆå¯¹åº”çš„ <code>Document</code> æ–‡æ¡£</strong>ï¼šé‡Œé¢æœ‰å¤šä¸ª <code>Node</code> èŠ‚ç‚¹ä¿¡æ¯ï¼Œä¿å­˜äº†æˆ‘ä»¬å†™çš„é…ç½®ä¿¡æ¯</li>
<li><strong>æ ¹æ® <code>Document</code> æ–‡ä»¶è¿›è¡Œ <code>Bean</code> ä¿¡æ¯è§£æ</strong></li>
</ul>
<p>â‘¢ <code>bean</code> æ ‡ç­¾çš„è§£æå’Œæ³¨å†Œ</p>
<ul>
<li><strong>å§”æ‰˜ <code>BeanDefinitionDelegate</code> ç±»çš„ <code>parseBeanDefinitionElement</code> æ–¹æ³•</strong>ï¼šå¯¹å…ƒç´ è¿›è¡Œè§£æï¼Œè¿”å› <code>BeanDefinitionHolder</code> ç±»å‹çš„å®ä¾‹ï¼ˆé‡Œé¢åŒ…å«äº† <code>class</code>ã€ <code>name</code>ã€ <code>id</code>ã€ <code>alias</code>ç­‰å±æ€§ï¼‰</li>
<li><strong>è§£ææ ‡ç­¾</strong>ï¼šåˆ¤æ–­æ ‡ç­¾ç±»å‹ï¼Œçœ‹è§£æçš„æ˜¯é»˜è®¤æ ‡ç­¾è¿˜æ˜¯è‡ªå®šä¹‰æ ‡ç­¾</li>
<li><strong>å¯¹ <code>bdHodler</code> è¿›è¡Œæ³¨å†Œ</strong>ï¼šè§£æå®Œæˆåï¼Œæ³¨å†Œ <code>bean</code> ä¿¡æ¯ï¼Œæ³¨å†Œæ“ä½œå§”æ‰˜ç»™äº† <code>BeanDefinitionReaderUtils</code> çš„ <code>registerBeanDefinition</code> æ–¹æ³•</li>
<li><strong>å‘é€å“åº”äº‹ä»¶</strong>ï¼šé€šçŸ¥ç›¸å…³çš„ç›‘å¬å™¨ï¼Œé€šçŸ¥ <code>bean</code> å®¹å™¨å·²ç»åŠ è½½å®Œæˆ</li>
</ul>
<p>ä¸‹ä¸€ç¯‡ç¬”è®°å†ä¼š~</p>
<hr>
<h1 id="è¸©å‘è®°å½•"><a href="#è¸©å‘è®°å½•" class="headerlink" title="è¸©å‘è®°å½•"></a>è¸©å‘è®°å½•</h1><h3 id="Javadoc-generation-failed-Generated-Javadoc-options-file-useful-for-troubleshooting"><a href="#Javadoc-generation-failed-Generated-Javadoc-options-file-useful-for-troubleshooting" class="headerlink" title="Javadoc generation failed. Generated Javadoc options file (useful for troubleshooting)"></a>Javadoc generation failed. Generated Javadoc options file (useful for troubleshooting)</h3><p>åœ¨ç¼–è¯‘æ—¶ï¼Œå‘ç°æ— æ³•æˆåŠŸï¼Œæç¤º <code>Javadoc</code> çš„é”™è¯¯ï¼Œè§£å†³æ–¹æ³•æ˜¯åœ¨ <code>gradle</code> æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tasks.withType(Javadoc) &#123;</span><br><span class="line">    options.addStringOption(&apos;Xdoclint:none&apos;, &apos;-quiet&apos;)</span><br><span class="line">    options.addStringOption(&apos;encoding&apos;, &apos;UTF-8&apos;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="ä¼ é€é—¨ï¼š"><a href="#ä¼ é€é—¨ï¼š" class="headerlink" title="ä¼ é€é—¨ï¼š"></a>ä¼ é€é—¨ï¼š</h1><ul>
<li><p><a href="https://vip-augus.github.io/2019/06/08/spring/2019-06-08-spring-analysis-note-env-prepared" target="_blank" rel="noopener">Spring æºç å­¦ä¹ -ç¯å¢ƒå‡†å¤‡</a></p>
</li>
<li><p><a href="https://vip-augus.github.io/2019/06/08/spring/2019-06-08-spring-analysis-note-1" target="_blank" rel="noopener">Spring æºç å­¦ä¹ (ä¸€)å®¹å™¨çš„åŸºç¡€ç»“æ„</a></p>
</li>
<li><p><a href="https://vip-augus.github.io/2019/06/14/spring/2019-06-14-spring-analysis-note-2" target="_blank" rel="noopener">Spring æºç å­¦ä¹ (äºŒ)é»˜è®¤æ ‡ç­¾è§£æ</a></p>
</li>
<li><p><a href="https://vip-augus.github.io/2019/06/16/spring/2019-06-16-spring-analysis-note-3" target="_blank" rel="noopener">Spring æºç å­¦ä¹ (ä¸‰)è‡ªå®šä¹‰æ ‡ç­¾</a></p>
</li>
<li><p><a href="https://vip-augus.github.io/2019/06/19/spring/2019-06-19-spring-analysis-note-4" target="_blank" rel="noopener">Spring æºç å­¦ä¹ (å››) bean çš„åŠ è½½</a></p>
</li>
<li><p><a href="https://vip-augus.github.io/2019/06/22/spring/2019-06-22-spring-analysis-note-5" target="_blank" rel="noopener">Spring æºç å­¦ä¹ (äº”)å¾ªç¯ä¾èµ–</a></p>
</li>
<li><p><a href="https://vip-augus.github.io/2019/06/22/spring/2019-06-22-spring-analysis-note-6" target="_blank" rel="noopener">Spring æºç å­¦ä¹ (å…­)æ‰©å±•åŠŸèƒ½ ä¸Šç¯‡</a></p>
</li>
<li><p><a href="https://vip-augus.github.io/2019/06/30/spring/2019-06-30-spring-analysis-note-7" target="_blank" rel="noopener">Spring æºç å­¦ä¹ (ä¸ƒ)æ‰©å±•åŠŸèƒ½ ä¸‹ç¯‡</a></p>
</li>
<li><p><a href="https://vip-augus.github.io/2019/07/17/spring/2019-07-17-spring-analysis-note-8" target="_blank" rel="noopener">Spring æºç å­¦ä¹ (å…«) AOP ä½¿ç”¨å’Œå®ç°åŸç†</a></p>
</li>
<li><p><a href="https://vip-augus.github.io/2019/07/18/spring/2019-07-18-spring-analysis-note-9" target="_blank" rel="noopener">Spring æºç å­¦ä¹ (ä¹) Transaction äº‹åŠ¡</a></p>
</li>
<li><p><a href="https://vip-augus.github.io/2019/07/21/spring/2019-07-21-spring-analysis-note-10" target="_blank" rel="noopener">Spring æºç å­¦ä¹ (å) Spring mvc</a></p>
</li>
</ul>
<hr>
<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p>1ã€<a href="https://github.com/seaswalker/spring-analysis/blob/master/note/Spring.md" target="_blank" rel="noopener">spring-analysis/note/Spring.md</a></p>
<p>2ã€<a href="https://legacy.gitbook.com/book/muyinchen/spring-framework-5-0-0-m3/details" target="_blank" rel="noopener">Spring Framework 5.0.0.M3ä¸­æ–‡æ–‡æ¡£</a></p>
<p>3ã€Spring æºç æ·±åº¦è§£æ / éƒä½³ç¼–è‘—. â€“ åŒ—äº¬ : äººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾</p>
<p>4ã€<a href="https://blog.csdn.net/peaceforeveryone/article/details/78125175" target="_blank" rel="noopener">ä½¿ç”¨Spring3.1åçš„çš„Profileé…ç½®ä½¿ä¸åŒç¯å¢ƒåŠ è½½ä¸åŒé…ç½®æ–‡ä»¶</a></p>
<p>5ã€<a href="https://blog.csdn.net/boling_cavalry/article/details/81474340" target="_blank" rel="noopener">spring4.1.8æ‰©å±•å®æˆ˜ä¹‹ä¸€ï¼šè‡ªå®šä¹‰ç¯å¢ƒå˜é‡éªŒè¯</a></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Spring/" rel="tag"># Spring</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/06/08/spring/2019-06-08-spring-analysis-note-env_prepare/" rel="next" title="Spring æºç å­¦ä¹ -ç¯å¢ƒå‡†å¤‡">
                <i class="fa fa-chevron-left"></i> Spring æºç å­¦ä¹ -ç¯å¢ƒå‡†å¤‡
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/06/14/spring/2019-06-14-spring-analysis-note-2/" rel="prev" title="Spring æºç å­¦ä¹ (äºŒ)é»˜è®¤æ ‡ç­¾è§£æ">
                Spring æºç å­¦ä¹ (äºŒ)é»˜è®¤æ ‡ç­¾è§£æ <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zNjEzNi8xMjY3MQ=="></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="http://img.sevenyuan.cn/panda.jpg" alt="JingQ">
          <p class="site-author-name" itemprop="name">JingQ</p>
           
              <p class="site-description motion-element" itemprop="description">åŠªåŠ›å­¦ä¹ </p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">95</span>
                <span class="site-state-item-name">æ—¥å¿—</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">28</span>
                <span class="site-state-item-name">åˆ†ç±»</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">22</span>
                <span class="site-state-item-name">æ ‡ç­¾</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/Vip-Augus" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.weibo.com/yjq41596" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                    
                      Weibo
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.douban.com/people/YeJingQi" target="_blank" title="Douban">
                  
                    <i class="fa fa-fw fa-anchor"></i>
                  
                    
                      Douban
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="mailto://JingQBoom@gmail.com" target="_blank" title="E-Mail">
                  
                    <i class="fa fa-fw fa-envelope"></i>
                  
                    
                      E-Mail
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#åŸºç¡€ç»“æ„"><span class="nav-number">1.</span> <span class="nav-text">åŸºç¡€ç»“æ„</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ClassPathXmlApplicationContext"><span class="nav-number">1.1.</span> <span class="nav-text">ClassPathXmlApplicationContext</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#æ„é€ å™¨"><span class="nav-number">1.1.1.</span> <span class="nav-text">æ„é€ å™¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è®¾ç½®é…ç½®æ–‡ä»¶è·¯å¾„"><span class="nav-number">1.1.2.</span> <span class="nav-text">è®¾ç½®é…ç½®æ–‡ä»¶è·¯å¾„</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Environment"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">Environment</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Profile"><span class="nav-number">1.1.2.2.</span> <span class="nav-text">Profile</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Property"><span class="nav-number">1.1.2.3.</span> <span class="nav-text">Property</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PropertySource-æ¥å£"><span class="nav-number">1.1.2.4.</span> <span class="nav-text">PropertySource æ¥å£</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å°ç»“"><span class="nav-number">1.1.3.</span> <span class="nav-text">å°ç»“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Bean-çš„è§£æå’Œæ³¨å†Œ"><span class="nav-number">1.2.</span> <span class="nav-text">Bean çš„è§£æå’Œæ³¨å†Œ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#prepareRefresh-å‡†å¤‡æ›´æ–°"><span class="nav-number">1.2.1.</span> <span class="nav-text">prepareRefresh å‡†å¤‡æ›´æ–°</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#å…·ä½“æ ¡éªŒçš„æ–¹æ³•"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">å…·ä½“æ ¡éªŒçš„æ–¹æ³•</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#è‡ªå®šä¹‰ç¯å¢ƒå˜é‡æ ¡éªŒ"><span class="nav-number">1.2.1.2.</span> <span class="nav-text">è‡ªå®šä¹‰ç¯å¢ƒå˜é‡æ ¡éªŒ</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è·å–-bean-å®¹å™¨"><span class="nav-number">1.2.2.</span> <span class="nav-text">è·å– bean å®¹å™¨</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#BeanFactory-ç»§æ‰¿ä½“ç³»"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">BeanFactory ç»§æ‰¿ä½“ç³»</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#BanFactory-è‡ªå®šä¹‰"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">BanFactory è‡ªå®šä¹‰</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Bean-åŠ è½½å’Œè§£æ"><span class="nav-number">1.2.2.3.</span> <span class="nav-text">Bean åŠ è½½å’Œè§£æ</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#EntityResolver"><span class="nav-number">1.2.2.3.1.</span> <span class="nav-text">EntityResolver</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#BeanDefinitionReader"><span class="nav-number">1.2.2.3.2.</span> <span class="nav-text">BeanDefinitionReader</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#é…ç½®æ–‡ä»¶åŠ è½½"><span class="nav-number">1.2.2.4.</span> <span class="nav-text">é…ç½®æ–‡ä»¶åŠ è½½</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Bean-è§£æ"><span class="nav-number">1.2.2.5.</span> <span class="nav-text">Bean è§£æ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#é»˜è®¤æ ‡ç­¾è§£æ"><span class="nav-number">1.2.2.6.</span> <span class="nav-text">é»˜è®¤æ ‡ç­¾è§£æ</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#bean-æ ‡ç­¾è§£æ"><span class="nav-number">1.2.2.6.1.</span> <span class="nav-text">bean æ ‡ç­¾è§£æ</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#è·å–-id-å’Œ-name"><span class="nav-number">1.2.2.6.2.</span> <span class="nav-text">è·å– id å’Œ name</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#å¯¹æ ‡ç­¾ä¸­å…¶å®ƒå±æ€§çš„è§£æ"><span class="nav-number">1.2.2.6.3.</span> <span class="nav-text">å¯¹æ ‡ç­¾ä¸­å…¶å®ƒå±æ€§çš„è§£æ</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#BeanDefinition-ç»§æ‰¿ä½“ç³»"><span class="nav-number">1.2.2.6.4.</span> <span class="nav-text">BeanDefinition ç»§æ‰¿ä½“ç³»</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#BeanDefinitionHolder-ä¿®é¥°"><span class="nav-number">1.2.2.6.5.</span> <span class="nav-text">BeanDefinitionHolder ä¿®é¥°</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Bean-æ³¨å†Œ"><span class="nav-number">1.2.2.6.6.</span> <span class="nav-text">Bean æ³¨å†Œ</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#prepareBeanFactory"><span class="nav-number">1.2.3.</span> <span class="nav-text">prepareBeanFactory</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#postProcessBeanFactory"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">postProcessBeanFactory</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#invokeBeanFactoryPostProcessors"><span class="nav-number">1.2.3.2.</span> <span class="nav-text">invokeBeanFactoryPostProcessors</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#registerBeanPostProcessors"><span class="nav-number">1.2.3.3.</span> <span class="nav-text">registerBeanPostProcessors</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#initMessageSource"><span class="nav-number">1.2.3.4.</span> <span class="nav-text">initMessageSource</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#initApplicationEventMulticaster"><span class="nav-number">1.2.3.5.</span> <span class="nav-text">initApplicationEventMulticaster</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#onRefresh"><span class="nav-number">1.2.3.6.</span> <span class="nav-text">onRefresh</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#registerListeners"><span class="nav-number">1.2.3.7.</span> <span class="nav-text">registerListeners</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#finishBeanFactoryInitialization"><span class="nav-number">1.2.3.8.</span> <span class="nav-text">finishBeanFactoryInitialization</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#finishRefresh"><span class="nav-number">1.2.3.9.</span> <span class="nav-text">finishRefresh</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#resetCommonCaches"><span class="nav-number">1.2.3.10.</span> <span class="nav-text">resetCommonCaches</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#æ€»ç»“"><span class="nav-number">2.</span> <span class="nav-text">æ€»ç»“</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#è¸©å‘è®°å½•"><span class="nav-number">3.</span> <span class="nav-text">è¸©å‘è®°å½•</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Javadoc-generation-failed-Generated-Javadoc-options-file-useful-for-troubleshooting"><span class="nav-number">3.0.1.</span> <span class="nav-text">Javadoc generation failed. Generated Javadoc options file (useful for troubleshooting)</span></a></li></ol></li></ol><li class="nav-item nav-level-1"><a class="nav-link" href="#ä¼ é€é—¨ï¼š"><span class="nav-number">4.</span> <span class="nav-text">ä¼ é€é—¨ï¼š</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#å‚è€ƒèµ„æ–™"><span class="nav-number">5.</span> <span class="nav-text">å‚è€ƒèµ„æ–™</span></a></li></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-JingQ"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">JingQ</span>
</div>

<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  æœ¬ç«™è®¿å®¢æ•°:<span id="busuanzi_value_site_uv"></span>
</span>
</div>


<div class="powered-by">
  ç”± <a class="theme-link" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨
</div>

<a href="http://www.beian.miit.gov.cn">æµ™ICPå¤‡17002280å·-1</a> 

<div class="theme-info">
  ä¸»é¢˜ -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i> è®¿é—®äººæ•°
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i> æ€»è®¿é—®é‡
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      æ¬¡
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  






  





  

  

  

  

  

  

  
</body>
</html>
